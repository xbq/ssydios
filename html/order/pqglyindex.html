<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>砂石</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/style.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="../../css/scCss.css">
    <link rel="stylesheet" type="text/css" href="../../css/glyindex.css">
    <script type="text/javascript" src="../../script/api.js"></script>
    <script type="text/javascript" src="../../script/common.js"></script>
    <script type="text/javascript" src="../../script/jquery.min.js"></script>
    <script type="text/javascript" src="../../script/bootstrap.min.js"></script>

      <script type="text/javascript" src="../../script/gly.js"></script>
          <script src="../../script/echarts.simple.min.js"></script>
    <script src="../../script/week.js"></script>
  <style>
    a{ display:inline;}
  </style>
</head>
<body>
<div class="s-zd" id="s-zd"></div>
  <div id="wrap" class="flex-wrap flex-vertical">
    <div class="container grad" id="yd">
      <div class="i20"></div>
      <div class="row">

        <div class=" font2" align="center"> 首页 </div>

      </div>
      <div style="clear: both"></div>
    </div>



    <div id="main" class="flex-con"  >




<div class="i-wrs">
 <div class="i-wrs-title"><h1>今日概况</h1></div>

 <div class="i-wrs-content" id="i-imgc">

    <ul>

       <li>
           <div class="i-wrs-box">
           <div class="i-wrs-img igbox" align="center" >
           <img src="../../image/s-2.png">
           </div>
           <div class="i-wrs-txt" onclick="openjrydl()"><span>今日运单量</span><p><bdi id="count"></bdi> 单</p></div>
           </div>
       </li>
       <li>
           <div class="i-wrs-box">
           <div class="i-wrs-img igbox" align="center" >
           <img src="../../image/s-3.png">
           </div>
           <div class="i-wrs-txt" onclick="openjrydl()"><span>今日运砂量</span><p><bdi id="sum"></bdi> 吨</p></div>
           </div>
       </li>
       <li>
           <div class="i-wrs-box">
           <div class="i-wrs-img igbox" align="center" >
           <img src="../../image/s-6.png">
           </div>
           <div class="i-wrs-txt" onclick="opencsqaa()"><span>作业采砂船数量</span><p><bdi id="sandboat"></bdi> 只</p></div>
           </div>
       </li>
       <li>
           <div class="i-wrs-box">
           <div class="i-wrs-img igbox" align="center" >
           <img src="../../image/s-5.png">
           </div>
           <div class="i-wrs-txt" onclick="opencqaa()"><span>作业采区数量</span><p><bdi id="district"></bdi> 个</p></div>
           </div>
       </li>


    </ul>

 </div>

</div>

    <div class="s-clear"></div>

<div class="i-wrs" >
 <div class="i-wrs-title"><h1>运营概况</h1></div>

 <div class="i-wrs-content" id="i-imgc">

    <ul>

       <li>
           <div class="i-wrs-box">
           <div class="i-wrs-img igbox" align="center" >
           <img src="../../image/s-1.png">
           </div>
           <div class="i-wrs-txt"><span>采砂船数量</span><p><bdi id="sandboatCount"></bdi> 只</p></div>
           </div>
       </li>
       <li>
           <div class="i-wrs-box">
           <div class="i-wrs-img igbox" align="center" >
           <img src="../../image/s-8.png">
           </div>
           <div class="i-wrs-txt"><span>运砂船数量</span><p ><bdi id="sandcarrierCount"></bdi> 只</p></div>
           </div>
       </li>
       <li>
           <div class="i-wrs-box">
           <div class="i-wrs-img igbox" align="center" >
           <img src="../../image/s-7.png">
           </div>
           <div class="i-wrs-txt"><span>运单数量</span><p><bdi id="waybillCount"></bdi> 单</p></div>
           </div>
       </li>
       <li>
           <div class="i-wrs-box">
           <div class="i-wrs-img igbox" align="center" >
           <img src="../../image/s-4.png">
           </div>
           <div class="i-wrs-txt"><span>人员数量</span><p><bdi id="userCount"></bdi> 人</p></div>
           </div>
       </li>


    </ul>

 </div>

</div>

 <div class="s-clear"></div>

 <div class="i-wrs" >
  <div class="i-wrs-title"><h1>年度概况</h1></div>

  <div class="i-wrs-content" id="i-imgc">

     <ul>

        <li style="border-bottom:0">
            <div class="i-wrs-box">
            <div class="i-wrs-img igbox" align="center" >
            <img src="../../image/s-2.png">
            </div>
            <div class="i-wrs-txt"><span>今年运单总量</span><p><bdi id="totalcount"></bdi> 单</p></div>
            </div>
        </li>
        <li style="border-bottom:0">
            <div class="i-wrs-box">
            <div class="i-wrs-img igbox" align="center" >
            <img src="../../image/s-3.png">
            </div>
            <div class="i-wrs-txt"><span>今年运砂总量</span><p ><bdi id="totalsum"></bdi> 吨</p></div>
            </div>
        </li>


     </ul>

  </div>

 </div>
 <div class="s-clear"></div>

<div class="s-tb" style="z-index:8;position:relative">

  <div class="s-tb-t" style="position:relative;z-index:998;" >
  <h1>月度统计</h1>
  <div class="s-selname" id="s-selname" style="height:40px; overflow:hidden;position:relative;"><span id="sys-i">运单量(单)</span><span class="s-spimg"><img src="../../image/arrowico.png" > </span></div>

  <div class="s-sel-i" id="s-sel-i">
   <ul>
     <li onClick="tabs(1)">运单量(单)</li>
     <li onClick="tabs(2)">运砂量(吨)</li>
   </ul>

  </div>
  </div>
  <div style="height: 260px;  position:absolute; top:0; left:0;z-index:10; width:100%; "></div>
  <!-- <div   style="height: 10px; position:absolute; bottom:0; left:0;z-index:10; width:100%; "></div> -->
<div class="s-tb-c" id="s-tb-c"  style="width:98%; position:relative; margin-left:2%; overflow-x:scroll;z-index:9;-webkit-overflow-scrolling : touch;">
  <!-- <div class="s-tb-c"  style="padding-bottom:10px; position:relative; zoom:1;overflow:hidden; width:100%"> -->
  <div id="maina" style="width:100%;height:260px; position:relative; z-index:9; margin-top:-40px ;-webkit-overflow-scrolling : touch; "></div>
  </div>

</div>


<div style="height:10px; clear:both; background:#fff"></div>
    </div>



  </div>

    <link rel="stylesheet" type="text/css" href="../../css/waves.css">
      <script type="text/javascript" src="../../script/waves.min.js"></script>

</body>
</html>


<script>

$(document).on('ready', function () {

           Waves.init();
$("#s-selname").click(function(){
  //$("#s-selname").hide();
  $("#s-sel-i").show();
  $("#s-zd").show();

});


     $("#s-zd").click(function(){
 //$("#s-selname").show();
$("#s-sel-i").hide();

});


   });

function openjrydl()
{
  $api.setStorage('pqglyjryda',1);
  api.execScript({
          name:  'pqglylist',
  script: 'pqrandomSwitchBtnindex();'
  });
}
function opencsqaa()
{

  api.openWin({

                 name : 'order_pqglycsqtj',
                 url : '../order/pqglycsqtj.html',
                 slidBackEnabled:false,
                 reload:true,

         });

}

function opencqaa()
{

  api.openWin({

                 name : 'order_pqglycqtj',
                 url : '../order/pqglycqtj.html',
                 slidBackEnabled:false,
                 reload:true,

         });

}
   function tabs(num)

   {
	   $("#s-zd").hide();
         if(num==1)
		 {

       $("#sys-i").html("运单量(单)");
indexhuatu1($api.getStorage("a_myarrayindex1"));
   }
		 else
		 {
       $("#sys-i").html("运砂量(吨)");
indexhuatu1($api.getStorage("a_myarrayindex2"));

   }
//getsunmonth(num);
         $("#s-sel-i").hide();
	   	 $("#s-selname").show();
	   }

var worldMapContainer1 = document.getElementById('maina');

var resizeWorldMapContainer = function () {
    //worldMapContainer1.style.width = (window.innerWidth-10)+'px';
    worldMapContainer1.style.height = '260px';
worldMapContainer1.style.width = 12*70+'px';
};
resizeWorldMapContainer();

var myChart1 = echarts.init(worldMapContainer1);


myChart1.setOption({
    title : {
        text: '运砂量[吨]'
    },

    // color: ['#3398DB'],
    color: ['#18bbfe'],
    // tooltip : {
    //     trigger: 'axis',
    //     axisPointer : {            // 坐标轴指示器，坐标轴触发有效
    //         type : 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
    //     }
    // },
    grid: {
        left: '0%',
        right: '0%',
        bottom: '3%',

        containLabel:false
    },
    xAxis : [
        {
          position:'top',
          axisLine: {show:false},
          axisTick: {show:false},
          axisLabel: {show:false},
          splitArea: {show:false},
          splitLine: {show:false},
          axisLabel: {
rotate: 0,
},
            type : 'category',
            data : ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月', '9月', '10月', '11月', '12月'],

        }


    ],
    yAxis : [
        {
			 show : false,
            type : 'value',
            offset:0,
            nameTextStyle:{
              // fontSize:9,
              align: 'left',
              // width:'100%',
              // padding: 4
            },
              name:'运砂量[吨]',
              nameLocation:'middle',
              nameGap:40,
        }
    ],
    series : [
      //背景
      {
          // name:'成绩',

          type:'bar',
          // xAxisIndex:1,
             barWidth: '60px',
               barGap: '-100%', // Make series be overlap
          //颜色需要有透明度
           itemStyle: {normal: {color:'rgba(102, 102, 102,0.1)'}},
          //data填你需要的背景的值
          data:[]
      },

        {

          itemStyle: {

            color: new echarts.graphic.LinearGradient(
                     0, 0, 0, 1,
                     [
                         {offset: 0, color: '#1789ff'},
                         {offset: 1, color: '#17baff'},

                     ]
                 )
                       },
                       barMinHeight:20,
          label: {normal: {

               show: true,
               position: 'insideTop',
               textStyle: {
                              // fontWeight:'bolder',
                              fontSize : '14',
                              color:'#ffffff',

                              // fontFamily : '微软雅黑',
                          }

           }},
            name:'合计',
            type:'bar',

          //  barWidth: '60%',
           barWidth: '60px',

            data:[]
        }


    ]
});
myChart1.showLoading();
myChart1.setOption({
    series:[{data:[ ]},{data:[ ]}]
});
myChart1.hideLoading();







function sliding() {

  // GoToRefresh();
  api.closeWin({
    name:'glyindex',
    animation: {type:'none'}
  });

   }

   var myVar = setInterval(function(){ myTimer() }, 5000);
 var myVar1 = setInterval(function(){ myTimer1() }, 60000);
    function myTimer()

    {
      getaccount();
      getaccountnow();
      gettotalsandplant();
  //    getsunmonth(1);
    }

    function myTimer1()

    {
       $("#sys-i").html("运单量(单)");
 getsunmonth(1);
    }
   apiready = function () {

$api.fixTabBar($api.byId('footer'));
  //获取当前采区,砂厂,运砂船,采砂船的总量
getaccount();
//今日数量
getaccountnow();
gettotalsandplant();
//月度统计
getsunmonth(1);
   }


   function getaccount()
   {
     console.log("刷新："+12);

     api.ajax({
         url: functionURL + 'wayBillScreen/getInfo.json',
         method: 'get',

         headers:
         {

           login_token:$api.getStorage('loginToken')
         },
         data: {
             values: {
             location_id:  $api.getStorage('pianquid')
             },
             files: {
                 file: 'fs://a.gif'
             }
         }
     }, function(ret, err) {

  checkfw(JSON.stringify(ret));

             if(ret){

                var sandboatCount_el=document.getElementById("sandboatCount");
                var sandcarrierCount_el=document.getElementById("sandcarrierCount");
                var userCount_el=document.getElementById("userCount");
                var waybillCount_el=document.getElementById("waybillCount");
                $api.html(sandboatCount_el,ret['sandboatCount']);
                $api.html(sandcarrierCount_el,ret['sandcarrierCount']);
                $api.html(userCount_el,ret['userCount']);
                $api.html(waybillCount_el,ret['waybillCount']);

         }
         else {
           getaccount();
         }
     });

   }


   function getaccountnow()
   {

     api.ajax({
         url: functionURL + 'wayBillScreen/getSumCountOnRoad.json',
         method: 'get',

         headers:
         {

           login_token:$api.getStorage('loginToken')
         },
         data: {
             values: {
 location_id:  $api.getStorage('pianquid')
             },
             files: {
                 file: 'fs://a.gif'
             }
         }
     }, function(ret, err) {
             if(ret){

                var district_el=document.getElementById("district");
                var count_el=document.getElementById("count");
                var sum_el=document.getElementById("sum");
                var sandboat_el=document.getElementById("sandboat");
                $api.html(district_el,ret['district']);
                $api.html(count_el,ret['count']);
                $api.html(sum_el,ret['sum']);
                $api.html(sandboat_el,ret['sandboat']);

         }
         else {
           getaccountnow();
         }
     });

   }

function getsunmonth(num)
{

  var date=new Date();
     var year = date.getFullYear(); //年
  api.ajax({
      url: functionURL + 'wayBillScreen/getCountByMonth.json',
      method: 'get',

      headers:
      {

        login_token:$api.getStorage('loginToken')
      },
      data: {
          values: {
            year:year,
             location_id:  $api.getStorage('pianquid')
          },
          files: {
              file: 'fs://a.gif'
          }
      }
  }, function(ret, err) {
          if(ret){

            if( ret.length>0)
            {
                var myarray1=new Array(12);
                var myarray2=new Array(12);
                    for (i = 0; i < myarray1.length; i++) {
                    myarray1[i]=0;
                    }
                    for (i = 0; i < myarray2.length; i++) {
                    myarray2[i]=0;
                    }

                for (i = 0; i < ret.length; i++) {
                    var item = ret[i];
                    var j=item['month']-1;
                  myarray1[j]=item['count'];
                  myarray2[j]=item['sum'];

                }
                console.log(myarray1.toString());
indexhuatu1(myarray1.toString());
                //ysetrezmonth(myarray1);

                  $api.setStorage('a_myarrayindex1',myarray1.toString())
                  $api.setStorage('a_myarrayindex2',myarray2.toString());

// if(num==1)
// {
//   ysetrezmonth(myarray1);
// }
// else
// {
//   ysetrezmonth(myarray2);
// }




            }


      }
      else {
        getsunmonth();
      }
  });

}
function getData(str){
    return [str];
}



function ysetrezmonth(myarray)

{

// var str='';
//   for (i = 0; i < myarray.length; i++) {
//     str=str+myarray[i]+",";
//   }
//str=(str.substring(str.length-1)==',')?str.substring(0,str.length-1):str;
//var dataaa="{data:"+"["+str+"]"+"}";

  myChart1.setOption({
    series:[{data:[ ]},{data:[ ]}]
  });

  myChart1.setOption({

          series:[{data:[ ]},{data:myarray}]


  });

  //setTimeout(function(){
  window.onresize = function () {
      //重置容器高宽
      resizeWorldMapContainer();
      myChart1.resize();
  };
   //}, 150);

}


function indexhuatu1(myarray)
{
  var myarray = myarray.split(",");
    // myChart1.setOption({
    //     series:{data:[ ]}
    // });
var stt=Math.max.apply(null, myarray);
var myarray2=new Array(myarray.length);


  for (i = 0; i < myarray.length; i++) {
  myarray2[i]=stt;
  }


    myChart1.setOption({
    series:[{data:myarray2},{data:myarray}]
    });

    //setTimeout(function(){
    window.onresize = function () {
        //重置容器高宽
        resizeWorldMapContainer();
        myChart1.resize();
    };
}




function gettotalsandplant()
{
  var begintime=getFirstDayOfYear();
  var endtime=getday();
var group='sandplant';
  api.ajax({
      url: functionURL + 'wayBillScreen/countForApp.json',
      method: 'get',

      headers:
      {

        login_token:$api.getStorage('loginToken')
      },
      data: {
          values: {
              begintime:begintime,
              endtime:endtime,
              group:group,
              location_id:  $api.getStorage('pianquid')
          },
          files: {
              file: 'fs://a.gif'
          }
      }
  }, function(ret, err) {
    //checkfw(ret.mgs);
      checkfw(JSON.stringify(ret));
          if(ret){
            var count_el=document.getElementById("totalcount");
            var sum_el=document.getElementById("totalsum");

            $api.html(count_el,ret['count']);
            $api.html(sum_el,ret['sum']);

            }

      else {
        gettotalsandplant();
      }
  });
}

</script>
