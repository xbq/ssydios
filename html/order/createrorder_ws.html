<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>砂石运单</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/style.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/bootstrap.css">
<link rel="stylesheet" type="text/css" href="../../css/scCss.css">
    <script type="text/javascript" src="../../script/api.js"></script>
    <script type="text/javascript" src="../../script/common.js"></script>
    <script type="text/javascript" src="../../script/jquery.min.js"></script>
    <script type="text/javascript" src="../../script/bootstrap.min.js"></script>
        <script type="text/javascript" src="../../script/upimg.js"></script>
          <script type="text/javascript" src="../../script/tuisong.js"></script>
</head>

<style>
a,
a:link,a:focus,a:hover,
a:visited {
  color: #444444;
}

</style>
<body>
  <div id="wrap" class="flex-wrap flex-vertical">
    <div class="container grad">
      <div class="i20"></div>
      <div class="row">
        <div class="col-xs-3 font1" onClick="sliding()" > <img src="../../image/Drback.png"></div>
        <div class="col-xs-6 font2"> 完善运单 </div>
        <div class="col-xs-3 font3" onClick="takePhoto()"> <img src="../../image/sxj.png"> </div>
      </div>
      <div style="clear: both"></div>
            <div class="i5"></div>
    </div>
    <div id="main" class="flex-con " >

      <!-- 采区 -->
    <script>
    function ydinfofuncq()
    {

    $('#Memobox011').modal('hide');
     var ipenboxbz_el=document.getElementById("ipenboxbz");
      var sandboatRemark_el=document.getElementById("sandboatRemark");

    // $api.val(ipenboxbz_el,"");
    var htacchtml= $api.val(sandboatRemark_el)+"<span class='glyphicon glyphicon-pencil i-aapencil01'></span>";



     $api.html(ipenboxbz_el,htacchtml);

    }

    function ydinfofuncqshow()
    {

    $('#Memobox011').modal('show');


    }


    </script>

      <style>

      #Memobox011{ top:5%; padding:10px; }
      #Memobox011 h4{ padding:5px 0}
      #Memobox011 textarea{ width:96%}
      #Memobox011 .set-style { margin:5px 0; font-size:16px;}
      #Memobox011 p.error { font-size:12px;}
      #Memobox011  .modal-footer{ background:none;padding-top: 10px; padding-bottom: 10px;padding-top: 10px; padding-bottom: 10px;}
      #Memobox011 button{ padding:2px 10px; margin-top:5px}
      #Memobox011 .modal-header{ background: linear-gradient(to right, #17baff, #178aff); color: #fff; padding-top: 10px; padding-bottom: 10px;padding-top: 10px; padding-bottom: 10px;}
      #Memobox011 .modal-body{ font-size: 16px;}
      #Memobox011 .btcolor{ color: #178aff; border: 0; font-size: 16px;}

        /*#Memobox011{ top:13%; padding:10px; }
        #Memobox011 h4{ padding:5px 0}
        #Memobox011 textarea{ width:96%}
        #Memobox011 .set-style { margin:5px 0; font-size:16px;}
        #Memobox011 p.error { font-size:12px;}
        #Memobox011  .modal-footer{ background:none}
        #Memobox011 button{ padding:2px 10px; margin-top:5px}*/
        </style>
      <div class="modal fade Memobox" id="Memobox011" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal"
                  aria-hidden="true">×
              </button>
              <h4 class="modal-title" id="myModalLabel">
                添加采区备注
              </h4>
            </div>
            <div class="modal-body">

            <div class="form-group">
    <textarea class="form-control" rows="3" name="sandboatRemark" id="sandboatRemark" placeholder="添加采区备注"></textarea>


              </div>


            </div>
            <div class="modal-footer"  >
      <button type="button" class="btn btn-info btn-block" style="height:40px;lineHeight:40px;background:#0ea9ff"  onclick="ydinfofuncq()">提交</button>
            </div>
          </div>
        </div>
      </div>

      <!-- 采区 -->
          <style>
          #Memobox{ top:5%; padding:10px; }
          #Memobox h4{ padding:5px 0}
          #Memobox textarea{ width:96%}
          #Memobox .set-style { margin:5px 0; font-size:16px;}
          #Memobox p.error { font-size:12px;}
          #Memobox  .modal-footer{ background:none;padding-top: 10px; padding-bottom: 10px;padding-top: 10px; padding-bottom: 10px;}
          #Memobox button{ padding:2px 10px; margin-top:5px}
          #Memobox .modal-header{ background: linear-gradient(to right, #17baff, #178aff); color: #fff; padding-top: 10px; padding-bottom: 10px;padding-top: 10px; padding-bottom: 10px;}
          #Memobox .modal-body{ font-size: 16px;}
          #Memobox .btcolor{ color: #178aff; border: 0; font-size: 16px;}
            </style>
                <div class="modal fade Memobox" id="Memobox" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"
                            aria-hidden="true">×
                        </button>
                        <h4 class="modal-title" id="myModalLabel">
                          选择采区
                        </h4>
                      </div>
                      <div class="modal-body" id="caiquid">

                      </div>

                      <div class="modal-footer">
                     <a class="btn btn-default" data-dismiss="modal">关闭</a>
                 </div>

                    </div>
                  </div>
                </div>

                <!-- 砂厂 -->
                <script>
                function ydinfofunsq()
                {

                $('#Memobox012').modal('hide');
                var ipenboxbzsq_el=document.getElementById("ipenboxbzsq");
                var sandplantRemark_el=document.getElementById("sandplantRemark");

                // $api.val(ipenboxbz_el,"");
                var htacchtmlsq= $api.val(sandplantRemark_el)+"<span class='glyphicon glyphicon-pencil i-aapencil01'></span>";



                $api.html(ipenboxbzsq_el,htacchtmlsq);

                }

                function ydinfofunsqshow()
                {

                $('#Memobox012').modal('show');


                }


                </script>

                <style>

                #Memobox012{ top:5%; padding:10px; }
                #Memobox012 h4{ padding:5px 0}
                #Memobox012 textarea{ width:96%}
                #Memobox012 .set-style { margin:5px 0; font-size:16px;}
                #Memobox012 p.error { font-size:12px;}
                #Memobox012  .modal-footer{ background:none;padding-top: 10px; padding-bottom: 10px;padding-top: 10px; padding-bottom: 10px;}
                #Memobox012 button{ padding:2px 10px; margin-top:5px}
                #Memobox012 .modal-header{ background: linear-gradient(to right, #17baff, #178aff); color: #fff; padding-top: 10px; padding-bottom: 10px;padding-top: 10px; padding-bottom: 10px;}
                #Memobox012 .modal-body{ font-size: 16px;}
                #Memobox012 .btcolor{ color: #178aff; border: 0; font-size: 16px;}

                </style>
                <div class="modal fade Memobox" id="Memobox012" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                  <div class="modal-content">
                    <div class="modal-header">
                      <button type="button" class="close" data-dismiss="modal"
                          aria-hidden="true">×
                      </button>
                      <h4 class="modal-title" id="myModalLabel">
                        添加砂场备注
                      </h4>
                    </div>
                    <div class="modal-body">

                    <div class="form-group">
                <textarea class="form-control" rows="3" name="sandplantRemark" id="sandplantRemark" placeholder="添加砂场备注"></textarea>


                      </div>


                    </div>
                    <div class="modal-footer"  >
                <button type="button" class="btn btn-info btn-block" style="height:40px;lineHeight:40px;background:#0ea9ff"  onclick="ydinfofunsq()">提交</button>
                    </div>
                  </div>
                </div>
                </div>

      <!-- 砂场 -->
      <style>
        #Memobox_s{ top:5%; padding:10px; }
        #Memobox_s h4{ padding:5px 0}
        #Memobox_s textarea{ width:96%}
        #Memobox_s .set-style { margin:5px 0; font-size:16px;}
        #Memobox_s p.error { font-size:12px;}
        #Memobox_s  .modal-footer{ background:none}
        #Memobox_s button{ padding:2px 10px; margin-top:5px}
        </style>
            <div class="modal fade Memobox" id="Memobox_s" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"
                        aria-hidden="true">×
                    </button>
                    <h4 class="modal-title" id="myModalLabel">
                      选择砂场
                    </h4>
                  </div>
                  <div class="modal-body" id="shachangid">

                  </div>

                  <div class="modal-footer">
                 <a class="btn btn-default" data-dismiss="modal">关闭</a>
             </div>

                </div>
              </div>
            </div>

      <!-- 运单 -->

      <style>
        #Memobox_y{ top:13%; padding:10px; }
        #Memobox_y h4{ padding:5px 0}
        #Memobox_y textarea{ width:96%}
        #Memobox_y .set-style { margin:5px 0; font-size:16px;}
        #Memobox_y p.error { font-size:12px;}
        #Memobox_y  .modal-footer{ background:none}
        #Memobox_y button{ padding:2px 10px; margin-top:5px}
        </style>
      <div class="modal fade Memobox" id="Memobox_y" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal"
                  aria-hidden="true">×
              </button>
              <h4 class="modal-title" id="myModalLabel">
                添加运砂量
              </h4>
            </div>
            <div class="modal-body">

            <div class="form-group">

      <input type="text" id="ydinfo" name="ydinfo" class="form-control" placeholder="运砂量(吨)">

              </div>


            </div>
            <div class="modal-footer"  >
      <button type="button" class="btn btn-info btn-block" style="height:40px;lineHeight:40px;background:#0ea9ff" onClick="ydinfofun()">提交</button>
            </div>
          </div>
        </div>
      </div>


      <!--发货方-->

  	  <div class="tab-bg container tabboxaaa" id="tab-bg " >

  		  <div class="row" style="overflow:hidden">
  			  <div class="col-xs-4 ddxq-font1">
  				  <div><span>发货方</span></div>
  			  </div>
          <div class="col-xs-8 ">
            <div class="i-bzaa" onclick="ydinfofuncqshow()" ><span class="i-penbox" id="ipenboxbz" style="display:none"><span class="glyphicon glyphicon-pencil i-aapencil"></span>添加采区备注</span></div>
          </div>

  		  </div>
          <a href="#" data-toggle="modal" data-target="#Memobox" style="width:100%; padding:0; margin:0; position:relative; zoom:1;">
  		  <div class="row i-baza01">
  			  <div class="col-xs-10 ddxq-font1">
            <strong  id="caiquid_sel"><img src="../../image/tj.png">添加采区信息<bdi id="caiqucao"></bdi></strong>
  				  <!-- <strong>发货方：南赣3号</strong> -->
  			  </div>
  			  <div class="col-xs-2 gpdd-font3">
  				  <span class="glyphicon glyphicon-chevron-right"></span>
  			  </div>
  		  </div>

  <input type="hidden" id="from_district" class="form-control" readonly="readonly"/>

      <div id="csq">
  		  <!-- <div class="row">
  			  <div class="col-xs-6 gpdd-font2">
  				  采砂船：NC-123556
  			  </div>
  			  <div class="col-xs-6 gpdd-font2 gpdd-r">
  				 南昌中支采区
  			  </div>
  		  </div> -->
      </div>
  </a>
  	  </div>

  	  <!--收货方-->
  <!-- <a href="#" data-toggle="modal" data-target="#Memobox_s" style="width:100%; padding:0; margin:0"> -->

  	  <div class="tab-bg container tabboxaaa" id="tab-bg " >


  		  <div class="row" style="overflow:hidden">
  			  <div class="col-xs-4 ddxq-font1">
  				  <div><span>收货方</span></div>
  			  </div>
          <div class="col-xs-8 ">
            <div class="i-bzaa" onclick="ydinfofunsqshow()" ><span class="i-penbox" id="ipenboxbzsq" style="display:none"><span class="glyphicon glyphicon-pencil i-aapencil"></span>添加砂场备注</span></div>
          </div>
  		  </div>
    <a onClick="open_shac(1)" style="width:100%; padding:0; margin:0">
  		  <div class="row i-baza01">

  			  <div class="col-xs-10 ddxq-font1">
              <strong  id="shachang_sel"><img src="../../image/tj.png">添加砂场信息</strong>
  				  <!-- <strong>收货单位：南昌赣昌砂场</strong> -->
  			  </div>
  			  <div class="col-xs-2 gpdd-font3">
  				  <span class="glyphicon glyphicon-chevron-right"></span>
  			  </div>
  		  </div>

          <input type="hidden" id="to_district" class="form-control" readonly="readonly"/>
  		  <!-- <div class="row">
  			  <div class="col-xs-6 gpdd-font2">
  				  收货员：李四
  			  </div>
  			  <div class="col-xs-6 gpdd-font4">
  				 13578951254
  			  </div>
  		  </div> -->
</a>
  	  </div>

  	  <!--运砂船-->
      <!--
      <a onClick="open_ysc(1)" style="width:100%; padding:0; margin:0">
      -->
            <a  style="width:100%; padding:0; margin:0">
  	  <div class="tab-bg container" id="tab-bg "  style="padding:0px auto; margin:0px auto 0px">


        <div class="row">
  			  <div class="col-xs-12 ddxq-font1">
  				  <div><span>运砂船</span></div>
  			  </div>
  		  </div>

  		  <div class="row">
  			  <div class="col-xs-10 ddxq-font1">
              <strong  id="ysqname"><img src="../../image/tj.png">添加运砂船信息</strong>
  				   <!-- <a onclick="open_ysc()"><div><span>添加运砂船信息</span></div></a> -->
  			  </div>

          <div class="col-xs-2 gpdd-font3">
            <span class="glyphicon glyphicon-chevron-right"></span>
          </div>
  		  </div>

          <input type="hidden" id="boat_id" class="form-control" readonly="readonly"/>
<div id="ysq_tel_name"></div>

  		  <!-- <div class="row">
  			  <div class="col-xs-10 ddxq-font2">
  				  <strong>运砂船：赣昌砂石JC-023</strong>
  			  </div>
  			  <div class="col-xs-2 gpdd-font3">
  				  <span class="glyphicon glyphicon-chevron-right"></span>
  			  </div>
  		  </div>
  		  <div class="row">
  			  <div class="col-xs-6 gpdd-font2">
  				  运货员：赵武
  			  </div>
  			  <div class="col-xs-6 gpdd-font4">
  				 13578951254
  			  </div>
  		  </div> -->
  	  </div>
      </a>
  	  <!--订单信息-->
      <!--
        <a href="#" data-toggle="modal" data-target="#Memobox_y" style="width:100%; padding:0; margin:0">
        -->
          <a href="#"  style="width:100%; padding:0; margin:0">
  	  <div class="tab-bg container" style="padding:0px auto; margin:0px auto 0px">

        <div class="row">
  			  <div class="col-xs-12 ddxq-font1">
  				  <div><span>订单信息</span></div>
  			  </div>
  		  </div>

  		  <div class="row" style="position:relative">
              <div style="position:absolute; right:12%; top:0px; line-height:30px" id="datarqsel"></div>
  			  <div class="col-xs-10 ddxq-font1">
              <strong  id="ydinfo_sel"><img src="../../image/tj.png">添加订单信息</strong>
  				    <!-- <a href="#" data-toggle="modal" data-target="#Memobox_y"><span class="glyphicon glyphicon-plus"><div><span>订单信息</span></div></a> -->
  			  </div>
          <div class="col-xs-2 gpdd-font3">
            <span class="glyphicon glyphicon-chevron-right"></span>
          </div>
<!--
          <div class="col-xs-12" >
            <div class="col-xs-12" id="datarqsel"></div>
            </div>-->
              <div class="col-xs-12" id="showjz_hs">
                <div class="col-xs-5 gpdd-font2 " id="datajzsel"  style="display:none; padding-left:0; padding-right:0"></div>
                <div class="col-xs-7 gpdd-font2 gpdd-r" id="datahssel" style="display:none;padding-left:0; padding-right:0"></div>
          <!-- <div class="col-xs-6" id="datajzsel" style="display:none"></div>
          <div class="col-xs-6" id="datahssel" style="display:none"></div> -->
          </div>

  		  </div>

  		   <!-- <div class="row">
  			  <div class="col-xs-10 ddxq-font2">
  				  <strong>货物体积：52吨</strong>
  			  </div>
  			  <div class="col-xs-2 gpdd-font3">
  				<span class="glyphicon glyphicon-chevron-right"></span>
  			  </div>
  		  </div>
  		  <div class="row">
  			  <div class="col-xs-12 gpdd-font2">
  				  创建时间：11/02 10：00
  			  </div>
  		  </div> -->
  	  </div>
      </a>
  	   <!--装载照片-->
       <input type="hidden" name="uid" id="uid" value="" style="width:100px; margin:0 auto; height:20px; padding-left:50px; background:#f00"/>
       <span  style="width:100%; padding:0; margin:0">
  	  <div class="tab-bg container ddxq-t" style="padding:0px auto; margin:0px auto 0px">
  		  <div class="row"><!--已发布、已签收的时候显示装载照片-->
          <div class="col-xs-12 ddxq-font1">
            <div><span>装载照片</span>
              <!-- <span onclick="otj()">提交</span> -->
            </div>
          </div>


          <div class="row ddxq-picw" id="simg"><div class="col-xs-4"  onclick="takePhoto()" >  <a  class="ddxq-pic-cc"   ></a> </div></div>
        </div>
  	  </div>
        </span>
  	  <div class="ddxq-btn" id="ccyid"><!--点击改派按钮的时候显示确认改派按钮-->
        <button type="button" onClick="subtijiao()">完善订单</button>
      </div>
    </div>
  </div>


</body>




<script>

function subtijiaostatus()
{
  var ydinfo_el=document.getElementById("ydinfo");
  var boat_id_el=document.getElementById("boat_id");
  var to_district_el=document.getElementById("to_district");
  var from_district_el=document.getElementById("from_district");
var boat_id=$api.val(boat_id_el);
var from_district=$api.val(from_district_el);
var to_district=$api.val(to_district_el);
var deliver=$api.getStorage('usid');
var sandboat_id=$api.getStorage('ucsc06id');
var weight=$api.val(ydinfo_el);




var sandplantRemark_el=document.getElementById("sandplantRemark");
var sandboatRemark_el=document.getElementById("sandboatRemark");
var sandplantRemark=$api.val(sandplantRemark_el);
var sandboatRemark=$api.val(sandboatRemark_el);




var uid_el=document.getElementById("uid");
var suid=$api.val(uid_el);
api.ajax({
   url: functionURL + 'wayBillScreen/update.json',
   method: 'post',
   headers:
   {

     login_token:$api.getStorage('loginToken')
   },
   dataType:'text',
   headers:
   {

     login_token:$api.getStorage('loginToken')
   },
   data: {
       values: {
           uid: suid,

           from_district: from_district,
           to_district: to_district,
           deliver: deliver,
sandplantRemark:sandplantRemark,
sandboatRemark:sandboatRemark,
         //  sandtype:sandtype,
           status:2

       },
       files: {
           file: 'fs://a.gif'
       }
   }
}, function(ret, err) {
 //console.log(ret);
   if (ret) {
     if(ret>0)
     {
     api.alert({ title: "修改成功" });

//$api.rmStorage('dingdan');
  var ccyid_el=document.getElementById("ccyid");
  $api.css(ccyid_el,"display:none");


  api.closeWin({
      name: 'order_orderlist'
  });

  api.openWin({
             name : 'order_orderlist',
             url : '../order/orderlist.html',
              reload:true,
             slidBackEnabled:false,
             delay:150,
             animation:{
               type:"fade",
               subType:"from_bottom",
           }

         })

       }
       else {
         api.alert({ title: "添加失败" });
       }

   } else {
       api.alert({ title: "添加失败" });
   }
});

}
function subtijiao()
{
   var ydinfo_el=document.getElementById("ydinfo");
   var boat_id_el=document.getElementById("boat_id");
   var to_district_el=document.getElementById("to_district");
   var from_district_el=document.getElementById("from_district");
var boat_id=$api.val(boat_id_el);
var from_district=$api.val(from_district_el);
var to_district=$api.val(to_district_el);
var deliver=$api.getStorage('usid');
var sandboat_id=$api.getStorage('ucsc06id');
var weight=$api.val(ydinfo_el);

var sandplantRemark_el=document.getElementById("sandplantRemark");
var sandboatRemark_el=document.getElementById("sandboatRemark");
var sandplantRemark=$api.val(sandplantRemark_el);
var sandboatRemark=$api.val(sandboatRemark_el);

if(from_district=="")
{
 api.alert({
        title: '请选择采区信息'
    });
return false;
}

if(to_district=="")
{
 api.alert({
        title: '请选砂场信息'
    });
return false;
}



var strArr_aa=document.getElementById("simg").getElementsByTagName('IMG');
if(strArr_aa.length==0)
{
   api.alert({
          title: '请上传照片'
      });
  return false;
}



var uid_el=document.getElementById("uid");
var suid=$api.val(uid_el);
  s_updateimg_ws(suid);


}
// function subtijiao()
// {
//    var ydinfo_el=document.getElementById("ydinfo");
//    var boat_id_el=document.getElementById("boat_id");
//    var to_district_el=document.getElementById("to_district");
//    var from_district_el=document.getElementById("from_district");
// var boat_id=$api.val(boat_id_el);
// var from_district=$api.val(from_district_el);
// var to_district=$api.val(to_district_el);
// var deliver=$api.getStorage('usid');
// var sandboat_id=$api.getStorage('ucsc06id');
// var weight=$api.val(ydinfo_el);
//
// // if(boat_id=="")
// // {
// //  api.alert({
// //         msg: '请选择运砂船'
// //     });
// // return false;
// // }
//
// if(from_district=="")
// {
//  api.alert({
//         msg: '请选择采区信息'
//     });
// return false;
// }
//
// if(to_district=="")
// {
//  api.alert({
//         msg: '请选砂场信息'
//     });
// return false;
// }
//
// // if(weight=="")
// // {
// //  api.alert({
// //         msg: '请输入运砂量'
// //     });
// // return false;
// // }
//
// var strArr_aa=document.getElementById("simg").getElementsByTagName('IMG');
// if(strArr_aa.length==0)
// {
//    api.alert({
//           msg: '请上传照片'
//       });
//   return false;
// }
//
// // if($("#simg").html()=="")
// // {
// //  api.alert({
// //         msg: '请上传图片'
// //     });
// // return false;
// // }
//
// var uid_el=document.getElementById("uid");
// var suid=$api.val(uid_el);
// api.ajax({
//     url: functionURL + 'wayBillScreen/update.json',
//     method: 'post',
//     headers:
//     {
//
//       login_token:$api.getStorage('loginToken')
//     },
//     dataType:'text',
//     headers:
//     {
//
//       login_token:$api.getStorage('loginToken')
//     },
//     data: {
//         values: {
//             uid: suid,
//
//             from_district: from_district,
//             to_district: to_district,
//             deliver: deliver,
//
//           //  sandtype:sandtype,
//             status:2
//
//         },
//         files: {
//             file: 'fs://a.gif'
//         }
//     }
// }, function(ret, err) {
//   //console.log(ret);
//     if (ret) {
//       if(ret>0)
//       {
//       api.alert({ msg: "修改成功" });
//
// //$api.rmStorage('dingdan');
//    var ccyid_el=document.getElementById("ccyid");
//    $api.css(ccyid_el,"display:none");
// //上传图片
//
//
// // if($("#simg").html()=='')
// // {console.log(1);}
// //serverSendMessage2(suid);
//
// setTimeout(function() {
//
//   s_updateimg_ws(suid);
//
//   }, 100) ;
// //上传图片
//
//
//
//
//
//
//
//         }
//         else {
//           api.alert({ msg: "添加失败" });
//         }
//
//     } else {
//         api.alert({ msg: "添加失败" });
//     }
// });
//
//
// }
function sliding()
{
  api.closeWin({
    name:'order_createrorder_ws',
    animation: {type:'none'}
  });
}

function getNowDate() {
 var date = new Date();
 var sign1 = "-";
 var sign2 = ":";
 var year = date.getFullYear() // 年
 var month = date.getMonth() + 1; // 月
 var day  = date.getDate(); // 日
 var hour = date.getHours(); // 时
 var minutes = date.getMinutes(); // 分
 var seconds = date.getSeconds() //秒
 if (month >= 1 && month <= 9) {
   month = "0" + month;
  }
  if (day >= 0 && day <= 9) {
   day = "0" + day;
  }
  if (hour >= 0 && hour <= 9) {
   hour = "0" + hour;
  }
  if (minutes >= 0 && minutes <= 9) {
   minutes = "0" + minutes;
  }
  if (seconds >= 0 && seconds <= 9) {
   seconds = "0" + seconds;
  }
 var currentdate = year + sign1 + month + sign1 + day + " " + hour + sign2 + minutes + sign2 + seconds;
 $("#datarqsel").html(currentdate);
 //return currentdate;
}
function ydinfofun()
{



  if($("#eatWaterLine").val()!=""||$("#containWater").val()!="")
  {
    $("#showjz_hs").css("display","block");
  }
  else {
      $("#showjz_hs").css("display","none");
  }


   var ydinfo_el=document.getElementById("ydinfo");
   var ydinfo_sel_el=document.getElementById("ydinfo_sel");
var msaaa=0;
   var reg=/(^[1-9]{1}[0-9]*$)|(^[0-9]*\.[0-9]*$)/
          if(!reg.test($api.val(ydinfo_el))){

            msaaa=1;
                    //   return false;
            $api.val(ydinfo_el,"");


          }

if($("#eatWaterLine").val()!="")
{
          if(!reg.test($("#eatWaterLine").val())){

        msaaa=1;
        $("#eatWaterLine").val("");
          // return false;


          }
}
if($("#containWater").val()!="")
{
          if(!reg.test($("#containWater").val())){

        msaaa=1;
            $("#containWater").val("");
          // return false;


          }
}
          if(msaaa==1)
          {
            api.toast({
          msg: '请输入大于0的数字',
          duration: 2000,
          location: 'middle'
          });
        return false;
          }
getNowDate();
    $('#Memobox_y').modal('hide');


    $("#datajzsel").html("减载高度:"+$("#eatWaterLine").val()+"(cm)");
     $("#datahssel").html("含水系数:"+$("#containWater").val()+"%");
      if($("#eatWaterLine").val()!="")
    {

      $("#datajzsel").css("display","block");
    }
    else {
        $("#datajzsel").css("display","none");
    }
    if($("#containWater").val()!="")
    {

      $("#datahssel").css("display","block");
    }
    else {
        $("#datahssel").css("display","none");
    }



   $api.html(ydinfo_sel_el,$api.val(ydinfo_el)+"吨"+"("+$("#sandtype").val()+")");
}

function shac_uid(name,uid)
{


  var to_district_el=document.getElementById("to_district");

 var caiquid_sel_el=document.getElementById("shachang_sel");
 $api.html(caiquid_sel_el,name);
  $api.val(to_district_el,uid);
  $("#ipenboxbzsq").css("display","inline-block");

}


function ysq_uid(name,ownerId,ownerName,tel,uid)
{

    var ysqname_el=document.getElementById("ysqname");
    var boat_id_el=document.getElementById("boat_id");
   var ysq_tel_name_el=document.getElementById("ysq_tel_name");
   $api.html(ysqname_el,name);
   var html="";;
   //html="<span>"+ownerName+"</span>"+"<span>"+tel+"</span>";


    html+='<div class="row">';
    html+='<div class="col-xs-5 gpdd-font2">船主:';
    html+=ownerName;
    html+='</div>';
    html+='<div class="col-xs-7 gpdd-font2 gpdd-r">联系电话:';
    html+=tel;
    html+='</div>';
    html+='</div> ';

   $api.html(ysq_tel_name_el,html);
    $api.val(boat_id_el,uid);
}

function open_ysc(sx)
{

  api.openWin({

             name : 'order_ysq',
             url : '../order/ysq.html',
             slidBackEnabled:false,
             reload:true,
                pageParam: {id: sx},

     });
}

function open_shac(sx)
{

  api.openWin({

             name : 'order_shac',
             url : '../order/shac.html',
             slidBackEnabled:false,
             reload:true,
  pageParam: {id: sx},
     });
}


function caiquid(name,uid)
{

 var caiquid_sel_el=document.getElementById("caiquid_sel");
 var from_district_el=document.getElementById("from_district");
  var csq_el=document.getElementById("csq");
var html="";

html+='<div class="row">';
html+='<div class="col-xs-5 gpdd-font2">发货员:';
html+=$api.getStorage('usname');
html+='</div>';
html+='<div class="col-xs-7 gpdd-font2 gpdd-r">联系电话:';
html+=$api.getStorage('ucsc06tel');
html+='</div>';
html+='</div>';
 $api.html(csq_el,html);


 $api.html(caiquid_sel_el,"<bdi id='caiqucao'>"+name+"</bdi>("+$api.getStorage('ucsc06name')+")");
  $api.val(from_district_el,uid);
 $('#Memobox').modal('hide');

  $api.css($api.byId('s-fhbox'),'display:none');
 $("#ipenboxbz").css("display","inline-block");

}
function caiqu()
{
  api.ajax({

    url: functionURL + 'districtScreen/getAll.json',
      method: 'get',
      headers:
      {

        login_token:$api.getStorage('loginToken')
      },
      data: {
          values: {

          },
          files: {
              file: 'fs://a.gif'
          }
      }
  }, function(ret, err) {
      if (ret) {


       if( ret['data'].length>0)
           {
             var html = '';
             var caiquid_el=document.getElementById("caiquid");

             for (i = 0; i < ret['data'].length; i++) {
               var item = ret['data'][i];

                  html+='<div class="form-group" style=" width:100%" onclick=caiquid("'+item['name']+'",'+item['uid']+')>';
                  html+='<span >'+item['name']+'</span>';
                  html+='</div>';

             }

             $api.html(caiquid_el,html);

           }


      }
      else {
        caiqu()
      }
  });

}

function shachangid(name,uid)
{

  var to_district_el=document.getElementById("to_district");

 var caiquid_sel_el=document.getElementById("shachang_sel");
 $api.html(caiquid_sel_el,name);
  $api.val(to_district_el,uid);
 $('#Memobox_s').modal('hide');

  $api.css($api.byId('s-fhbox_s'),'display:none');
}

function shachang()
{
  api.ajax({

    url: functionURL + 'sandPlantScreen/getAll.json',
      method: 'get',
      headers:
      {

        login_token:$api.getStorage('loginToken')
      },
      data: {
          values: {

          },
          files: {
              file: 'fs://a.gif'
          }
      }
  }, function(ret, err) {
      if (ret) {


       if( ret['data'].length>0)
           {
             var html = '';
             var shachangid_el=document.getElementById("shachangid");

             for (i = 0; i < ret['data'].length; i++) {
               var item = ret['data'][i];

                  html+='<div class="form-group" style=" width:100%" onclick=shachangid("'+item['name']+'",'+item['uid']+')>';
                  html+='<span >'+item['name']+'</span>';
                  html+='</div>';

             }

             $api.html(shachangid_el,html);

           }


      }
      else {
        shachang();
      }
  });

}


var Htmls = "";
var timeOutEvent = 0;


//开始按
function gtouchstart(obj) {
Htmls=obj;
//alert(obj);
  //  Htmls = $(obj).parent().html();
      console.log(Htmls);
    timeOutEvent = setTimeout(function() {
      //  alert("清除了"); //因为页面弹动会导致元素一直处于按住的状态，所以超过700毫秒自动清空变量，避免点击其他元素触发事件

      api.confirm({
          title: '提示',
          msg: '确定删除此图片吗？',
          buttons: ['确定', '取消']
      }, function(ret, err) {
          var index = ret.buttonIndex;
          console.log(index);
          if(index==1)
          {
            console.log(obj);
          var simga_el=document.getElementById(obj);

            $api.remove(simga_el);
          }
      });



        Htmls = "";
    }, 500);
    return false;
};

//手释放，取消长按事件
function gtouchend() {
    clearTimeout(timeOutEvent);
//alert("addd");
    Htmls = "";
};

//如果手指有移动，则取消所有事件，此时说明用户只是要移动而不是长按
function gtouchmove() {
    clearTimeout(timeOutEvent);
    Htmls = "";
};


function takePhoto() {
       api.getPicture({
           sourceType: 'camera', //（可选项）图片源类型，从相册、图片库或相机获取图片
           encodingType: 'jpg', //（可选项）返回图片类型，jpg或png
           mediaValue: 'pic', //（可选项）媒体类型，图片或视频
           destinationType: 'url', //（可选项）返回数据类型，指定返回图片地址或图片经过base64编码后的字符串
           allowEdit: true,
           quality: 100, //（可选项）图片质量，只针对jpg格式图片（0-100整数）
          targetWidth: 800, //（可选项）压缩后的图片宽度，图片会按比例适配此宽度
          //targetHeight: 800, //（可选项）压缩后的图片高度，图片会按比例适配此高度
           saveToPhotoAlbum: true
       }, function(ret, err) {
           if (ret) {
            //   alert(JSON.stringify(ret));
               var imgSrc = ret.data;
                 var simg_el=document.getElementById("simg");

               var html='';
               var simgid=$api.getStorage('imgid');
                  // html+='<div class="col-xs-4" id="asimg0" >  <a  class="ddxq-pic" > <img src="../../image/sto.png" alt=""></a> <a onclick=removimg("asimg0")>删除</a></div>';
            html+='<div class="col-xs-4" id="asimg'+simgid+'" >  <a  class="ddxq-pic" onclick=ondown_y("'+imgSrc+'") ontouchstart=gtouchstart("asimg'+simgid+'") ontouchmove="gtouchmove()" ontouchend="gtouchend()"> <img src="'+imgSrc+'" alt=""></a> <a onclick=removimg("asimg'+simgid+'") style="display:none"><span class="glyphicon glyphicon-remove"></span>删除</a></div>';

               $api.append(simg_el,html);
               simgid= simgid+1;

               if(simgid==1)
               {
                 api.toast({
               msg: '长按照片可删除',
               duration: 2000,
               location: 'middle'
               });

               }


               $api.setStorage('imgid',simgid);



           } else {

             api.toast({
           msg: '照片传输失败！请重试',
           duration: 2000,
           location: 'middle'
           });

           }
       });
   }


function removimg(simga)
{
  console.log(simga);
var simga_el=document.getElementById(simga);

  $api.remove(simga_el);
}
apiready = function(){
caiqu();
shachang();
$api.setStorage('imgid',0);

  var sid = api.pageParam.id;
  var uid_el=document.getElementById("uid");
  $api.val(uid_el,sid);
  console.log(sid);

  api.ajax({
      url: functionURL + 'wayBillScreen/getListForApp.json',
      method: 'get',
      headers:
      {

        login_token:$api.getStorage('loginToken')
      },
      data: {
          values: {
              uid: sid
          },
          files: {
              file: 'fs://a.gif'
          }
      }
  }, function(ret, err) {
      if (ret) {
//console.log(JSON.stringify(ret));
    if( ret['data'].length>0){

        var item = ret['data'][0];
         console.log(item['weight']);
          console.log(item['boatId']);
         var sid=item['boatId'];

if(sid){
                          api.ajax({
                          url: functionURL + 'sandCarrierScreen/findOne.json',
                          method: 'post',
                          headers:
                          {

                            login_token:$api.getStorage('loginToken')
                          },
                          data: {
                              values: {
                                  uid: sid
                              },
                              files: {
                                  file: 'fs://a.gif'
                              }
                          }
                        }, function(reta, err) {
                                  if (reta) {

                                    if( reta['data'].length>0){

                                        var itema = reta['data'][0];
                                    var ysqname_el=document.getElementById("ysqname");
                                  var ysq_tel_name_el=document.getElementById("ysq_tel_name");
                                  $api.html(ysqname_el,itema['name']);

                                   var html="";;
                                   //html="<span>"+ownerName+"</span>"+"<span>"+tel+"</span>";
                                    html+='<div class="row">';
                                    html+='<div class="col-xs-5 gpdd-font2">船主:';
                                    html+=itema['ownerName'];
                                    html+='</div>';
                                    html+='<div class="col-xs-7 gpdd-font2 gpdd-r">联系电话:';
                                    html+=itema['tel'];
                                    html+='</div>';
                                    html+='</div> ';

                                   $api.html(ysq_tel_name_el,html);

                                     }

                                  }
                          });

}


            var boat_id_el=document.getElementById("boat_id");
            $api.val(boat_id_el,item['boatId']);

            var ydinfo_sel_el=document.getElementById("ydinfo_sel");
            $api.html(ydinfo_sel_el,item['weight']+"方");
            var ydinfo_el=document.getElementById("ydinfo");
            $api.val(ydinfo_el,item['weight']);

    }
  }
    });
};

</script>
</html>
