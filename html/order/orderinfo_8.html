<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>砂石运单</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/style.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="../../css/scCss.css">
    <script type="text/javascript" src="../../script/api.js"></script>
    <script type="text/javascript" src="../../script/common.js"></script>
    <script type="text/javascript" src="../../script/jquery.min.js"></script>
    <script type="text/javascript" src="../../script/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../script/upimg.js"></script>
        <script type="text/javascript" src="../../script/map.js"></script>
        <script type="text/javascript" src="../../script/mapzh.js"></script>
        <script type="text/javascript" src="../../script/tuisong.js"></script>
</head>


<body>

  <div id="wrap" class="flex-wrap flex-vertical">

    <div class="i-ats" id="i-ats">
       <ul>
       <li onclick="tjzpaa()">添加照片</li>
      </ul>
    </div>
    <style>

    .i-ats{ display: none;position:absolute; background:#fff; right:0;top:30px; width:150px; line-height:36px; padding:12px 20px; z-index:9999; font-size: 16px;box-shadow: 0px 0px 6px #888888;}
    </style>

    <div class="container grad">
        <div class="i20"></div>
      <div class="row">
        <div class="col-xs-3 font1" onClick="sliding()"> <img src="../../image/Drback.png"></div>
        <div class="col-xs-6 font2"> 订单详情 </div>
<div class="col-xs-3 font3" >

  <span  style=" float:right; margin-right:10px;display:none" onClick="openxz()" id="openxz"  >
 <img src="../../image/ssaz.png" >
 </span>
   <span  style=" float:right; margin-right:10px;display:none" onClick="opencama()" id="opencama"  >
 <img src="../../image/sxj.png"  >
 </span>
  <a    style="  position:absolute; right:10px; top:5px;display:none; font-size:14px; color:#fff"   onClick="glzpa_fb()"  id="bczpaa"  style="display:none"> <img src="../../image/ats.png"> </a>
</div>
      </div>
      <div style="clear: both"></div>
        <div class="i5"></div>
    </div>
    <div id="main" class="flex-con " >


        <input type="hidden" id="uid">
      <input type="hidden" id="ToDistrict">
   <div id="order_detail"></div>


    </div>
  </div>
  <script>

  function tjzpaa()
  {
    $("#i-ats").hide();
    var uid_el=document.getElementById("uid");
    var uid=$api.val(uid_el);

    api.openWin({
               name : 'order_orderphoto',
               url : '../order/orderphoto.html',
                reload:true,
               slidBackEnabled:false,
                 pageParam: {
                   id: uid,
                   fy:3
                 },

           })

  }

  function glzpa_fb()
  {

      api.actionSheet({
          buttons: [ '添加照片']
      }, function(ret, err) {
    var index = ret.buttonIndex;
    if(index==1)
    {
  tjzpaa();

    }

      })
  }
  function glzpa()
  {
  $("#i-ats").show();
  }


  $(document).on('ready', function () {
    $("#main").click(function(){
  $("#i-ats").hide();
  });

     });
  </script>

  <!-- <div id="wrap" class="flex-wrap flex-vertical">

    <div id="header_s">
        <ul>
            <li class="border-b active" >订单详情(运沙船主)<a class="menu" tapmode="" onClick="sliding()"></a><a class="member_gp02" onclick="openxz()" id="openxz" style="display:none"></a><a class="member_gp03" onclick="opencama()" id="opencama" style="display:none"></a></li>
        </ul>
    </div>




    <div id="main" class="flex-con" >

     <div style="padding：10px">
       <div id="order_detail"></div>
     </div>



<input type="text" id="uid">






    </div>



</DIV> -->
</body>
</html>


</body>
<script>
var Htmls = "";
var timeOutEvent = 0;


//开始按
function gtouchstart(obj) {
Htmls=obj;
//alert(obj);
  //  Htmls = $(obj).parent().html();
      console.log(Htmls);
    timeOutEvent = setTimeout(function() {
      //  alert("清除了"); //因为页面弹动会导致元素一直处于按住的状态，所以超过700毫秒自动清空变量，避免点击其他元素触发事件

      api.confirm({
          title: '提示',
          msg: '确定删除此图片吗？',
          buttons: ['确定', '取消']
      }, function(ret, err) {
          var index = ret.buttonIndex;
          console.log(index);
          if(index==1)
          {
            console.log(obj);
          var simga_el=document.getElementById(obj);

            $api.remove(simga_el);
          }
      });



        Htmls = "";
    }, 500);
    return false;
};

//手释放，取消长按事件
function gtouchend() {
    clearTimeout(timeOutEvent);
//alert("addd");
    Htmls = "";
};

//如果手指有移动，则取消所有事件，此时说明用户只是要移动而不是长按
function gtouchmove() {
    clearTimeout(timeOutEvent);
    Htmls = "";
};



function opencama()
{

  api.getPicture({
      sourceType: 'camera', //（可选项）图片源类型，从相册、图片库或相机获取图片
      encodingType: 'jpg', //（可选项）返回图片类型，jpg或png
      mediaValue: 'pic', //（可选项）媒体类型，图片或视频
      destinationType: 'url', //（可选项）返回数据类型，指定返回图片地址或图片经过base64编码后的字符串
      allowEdit: true,
      quality: 100, //（可选项）图片质量，只针对jpg格式图片（0-100整数）
     targetWidth: 800, //（可选项）压缩后的图片宽度，图片会按比例适配此宽度
    // targetHeight: 800, //（可选项）压缩后的图片高度，图片会按比例适配此高度
      saveToPhotoAlbum: true
  }, function(ret, err) {
      if (ret) {
       //   alert(JSON.stringify(ret));
          var imgSrc = ret.data;
            var simg7_el=document.getElementById("simg7");

          var html='';
          var simgid=$api.getStorage('4imgid');
             // html+='<div class="col-xs-4" id="asimg0" >  <a  class="ddxq-pic" > <img src="../../image/sto.png" alt=""></a> <a onclick=removimg("asimg0")>删除</a></div>';
       html+='<div class="col-xs-4" id="asimg'+simgid+'" >  <a  class="ddxq-pic" onclick=ondown_y("'+imgSrc+'") ontouchstart=gtouchstart("asimg'+simgid+'") ontouchmove="gtouchmove()" ontouchend="gtouchend()"> <img src="'+imgSrc+'" alt=""></a> <a onclick=removimg("asimg'+simgid+'") style="display:none"><span class="glyphicon glyphicon-remove"></span>删除</a></div>';

          $api.append(simg7_el,html);
          simgid= simgid+1;

          if(simgid==1)
          {
            api.toast({
          msg: '长按照片可删除',
          duration: 2000,
          location: 'middle'
          });

          }


          $api.setStorage('4imgid',simgid);


      } else {

        api.toast({
      msg: '照片传输失败！请重试',
      duration: 2000,
      location: 'middle'
      });
          //alert(JSON.stringify(err));
      }
  });

  // api.alert({
  //      msg: '拍照'
  //  });
}


//结束运输
function arr_da()
{
  var uid_el=document.getElementById("uid");
  var  uid=$api.val(uid_el);
  var ToDistrict_el=document.getElementById("ToDistrict");
    var  ToDistrict=$api.val(ToDistrict_el);
  //console.log(uid);
 console.log("经度"+$api.getStorage('jdnum'+uid));
 console.log("纬度"+$api.getStorage('wdnum'+uid));
  api.ajax({
      url: functionURL + 'wayBillScreen/stopCarry2.json',
      dataType:'json',
      headers:
      {

        login_token:$api.getStorage('loginToken')
      },
      method: 'post',
      data: {
          values: {
              waybillId: uid,
              longitude:$api.getStorage('jdnum'+uid),
              latitude:$api.getStorage('wdnum'+uid),
              //status:5
          },
          files: {
              file: 'fs://a.gif'
          }
      }
  }, function(ret, err) {
      if (ret) {

        if(ret['code']==1){
          api.alert({
               title: ret['msg']
           });

console.log(ToDistrict);
console.log(uid);
//serverSendMessage5(ToDistrict,uid);
  //  $api.rmStorage('yunshu');
    $api.rmStorage('yunshuid'+$api.getStorage('usid'));
    $api.rmStorage('dy'+$api.getStorage('usid'));
    //api.stopLocation();
    $api.rmStorage('yx_uid');
    // var reportLocation = api.require('reportLocation');
    // reportLocation.stopLocation();

    api.execScript({
          name: 'root',
    script: 'closeroot();'
    });
    // api.closeWin({
    //     name: 'order_orderinfo_8'
    // });
    api.closeWin({
        name: 'order_orderlist'
    });
        api.openWin({
                   name : 'order_orderlist',
                   url : '../order/orderlist.html',
                    reload:true,
                   slidBackEnabled:false,
                   delay:150,
                   animation:{
                     type:"fade",
                     subType:"from_bottom",
                 }

               })
             }
             else
             {
                 api.toast({
                     msg: ret['msg'],
                     duration: 2000,
                     location: 'middle'
                 });

             }
      }
  });

}

// function openxz()
// {
// if($api.getStorage('yunshu')==2)
// {
//   api.alert({
//        msg: '请先停止定位'
//    });
//
// }
// else {
//   api.confirm({
//       title: '申请卸货',
//       msg: '确认已到达砂厂',
//       buttons: ['确定', '取消']
//   }, function(ret, err) {
//       var index = ret.buttonIndex;
//        if(index==1)
//        {
//          arr_da();
//        }
//   });
//
// }
//
// }



function ysa1(sid)
{
console.log(sid);
  if($api.getStorage('dy'+$api.getStorage('usid'))==1)
  {
    api.toast({
        msg: '有订单在运输中！',
        duration: 2000,
        location: 'middle'
    });



  }
  else{
    api.toast({
        msg: '开始定位',
        duration: 2000,
        location: 'middle'
    });

         $api.setStorage('yunshuid'+$api.getStorage('usid'),sid);
         $api.setStorage('dy'+$api.getStorage('usid'),1);
         $("#sys1").html('<button type="button" onClick="ysa2('+sid+')" id="ys" >结束运输并卸货</button>');


$api.setStorage('yx_uid',sid);

api.execScript({
      name: 'root',
script: 'mapdw();'
});

    }


}

function astop()
{
  var reportLocation = api.require('reportLocation');
  reportLocation.stopLocation();
}
function ysa2(sid)
{
console.log(sid);

api.confirm({
    title: "确认到达",
    msg: "请确认已到达砂场",
    buttons: ['确定', '取消']
}, function(ret, err) {
    var index = ret.buttonIndex;
    if(index==1)
    {
  arr_da();

      }

    }
);




}
// function ys0a()
// {
//        var ys_el=document.getElementById("ys");
// if( $api.html(ys_el)=="确认并开始运输")
// {
//
//   $api.setStorage('yunshu',2);
//
//
//       $api.html(ys_el,"结束运输");
//       api.alert({
//            msg: '开始定位'
//        });
//
//     //    var uid_el=document.getElementById("uid");
//     //    var  uid=$api.val(uid_el);
//     //  getLocation3(trace_interval, trace_accuracy, trace_filter,uid);
//
//
// }
// else {
//
//   if($api.getStorage('yunshu')==1)
//   {
//      $api.setStorage('yunshu',2);
//
//
//          $api.html(ys_el,"结束运输");
//          api.alert({
//               msg: '开始定位'
//           });
//
//
//          }
//  else  if($api.getStorage('yunshu')==2)
//  {
//
//    $api.setStorage('yunshu',1);
//
//
//        $api.html(ys_el,"开始运输");
//        api.alert({
//             msg: '结束定位'
//         });
//
//          }
//
//
// }
//
//
// }

// function ys1()
// {
//      $api.setStorage('yunshu',0);
//         console.log(0);
//      var ys_el=document.getElementById("ys");
//        $api.html(ys_el,"开始运输");
//
// }
//开始运输
function submit4()
{
//console.log($api.getStorage('dy'+$api.getStorage('usid')));
  if($api.getStorage('dy'+$api.getStorage('usid'))==1)
  {
    api.toast({
        msg: '有订单在运输中！',
        duration: 2000,
        location: 'middle'
    });
    var uid_el=document.getElementById("uid");
  var  uid=$api.val(uid_el);
  //  getLocation4(trace_interval, trace_accuracy, trace_filter,uid);
    //return false;
    console.log("sa1");
  }
  else {

console.log("sa2");
  var uid_el=document.getElementById("uid");
var  uid=$api.val(uid_el);
console.log(uid);


  api.ajax({
    //  url: functionURL + 'wayBillScreen/update.json',
    url: functionURL + 'wayBillScreen/startCarry.json',
      dataType:'text',
      headers:
      {

        login_token:$api.getStorage('loginToken')
      },
      method: 'post',
      data: {
          values: {
              waybillId: uid,
          //    status:4
          },
          files: {
              file: 'fs://a.gif'
          }
      }
  }, function(ret, err) {
      if (ret) {

        if(ret==1){
          // api.alert({
          //      msg: '修改成功'
          //  });
   //$api.setStorage('yunshu',1);
  // $api.setStorage('yunshu_z',1);//运输中
  $api.setStorage('yx_uid',uid);
  setTimeout(function(){
  api.execScript({
        name: 'root',
  script: 'mapdw();'
  });
  },100);
console.log("a123");
$api.setStorage('yunshuid'+$api.getStorage('usid'),uid);

$api.setStorage('dy'+$api.getStorage('usid'),1);
//$api.setStorage('yx_uid',uid);
//setTimeout(function(){

//},200)
// setTimeout(function(){
//
// api.execScript({
//       name: 'order_orderlist',
// script: 'location.reload();'
// });
// },300)
//getLocation4(trace_interval, trace_accuracy, trace_filter,uid);

$("#sys1a").html('<button type="button" onClick="ysa2('+uid+')" id="ys" >结束运输并卸货</button>');
api.toast({
    msg: '开始定位',
    duration: 2000,
    location: 'middle'
});
// setTimeout(function(){
// $("#sys1a").html('<button type="button" onClick="ysa2('+uid+')" id="ys" >结束运输并卸货</button>');
// },100)
//window.location.reload();
//console.log($api.getStorage('dy'+$api.getStorage('usid')));

        // api.openWin({
        //            name : 'order_orderlist',
        //            url : '../order/orderlist.html',
        //             reload:true,
        //            slidBackEnabled:false,
        //            delay:150,
        //            animation:{
        //              type:"fade",
        //              subType:"from_bottom",
        //          }
        //
        //        })
             }
      }
  });

    }
}


function sliding()
{
  api.closeWin({
    name:'order_orderinfo_8',
    animation: {type:'none'}
  });
}


//采砂船确认
function submit5()
{
$("#status52").css('display','none');
  var uid_el=document.getElementById("uid");
var  uid=$api.val(uid_el);
  var boatId_el=document.getElementById("boatId");
  var boatId=$api.val(boatId_el);
console.log();
//console.log(uid);
api.showProgress({
    animationType:'zoom',
    modal: false
});
  api.ajax({
  //  url: functionURL + 'wayBillScreen/update.json',
   url: functionURL + 'wayBillScreen/sandBoatEnsure.json',
      dataType:'text',
      headers:
      {

        login_token:$api.getStorage('loginToken')
      },
      method: 'post',
      data: {
          values: {
              //uid: uid,
              waybillId: uid,
            //  status:3
          },
          files: {
              file: 'fs://a.gif'
          }
      }
  }, function(ret, err) {
      api.hideProgress();
      if (ret) {

        if(ret==1){
          // api.alert({
          //      msg: '修改成功'
          //  });
//serverSendMessage3(boatId,uid);

api.closeWin({
    name: 'order_orderlist'
});

        api.openWin({
                   name : 'order_orderlist',
                   url : '../order/orderlist.html',
                    reload:true,
                   slidBackEnabled:false,
                   delay:150,
                   animation:{
                     type:"fade",
                     subType:"from_bottom",
                 }

               })
             }
      }
  });
}


//运砂船主确认运砂量
function submit6()
{
  var uid_el=document.getElementById("uid");
var  uid=$api.val(uid_el);
//console.log(uid);
  api.ajax({
      url: functionURL + 'wayBillScreen/carrierEnsure.json',
      dataType:'text',
      headers:
      {

        login_token:$api.getStorage('loginToken')
      },
      method: 'post',
      data: {
          values: {
              waybillId: uid,
            //  status:7
          },
          files: {
              file: 'fs://a.gif'
          }
      }
  }, function(ret, err) {
      if (ret) {

        if(ret==1){
          api.alert({
               title: '修改成功'
           });

           api.closeWin({
               name: 'order_orderlist'
           });
        api.openWin({
                   name : 'order_orderlist',
                   url : '../order/orderlist.html',
                    reload:true,
                   slidBackEnabled:false,
                   delay:150,
                   animation:{
                     type:"fade",
                     subType:"from_bottom",
                 }

               })
             }
      }
  });
}

function submit788status()
{




  var uid_el=document.getElementById("uid");
var  uid=$api.val(uid_el);
//console.log(uid);
  api.ajax({
      url: functionURL + 'wayBillScreen/unload.json',
      dataType:'text',
      headers:
      {

        login_token:$api.getStorage('loginToken')
      },
      method: 'post',
      data: {
          values: {
              waybillId: uid,
            //  status:8
          },
          files: {
              file: 'fs://a.gif'
          }
      }
  }, function(ret, err) {
      if (ret) {

        if(ret==1){
          api.alert({
               title: '修改成功'
           });

           api.closeWin({
               name: 'order_orderlist'
           });

           api.openWin({
                      name : 'order_orderlist',
                      url : '../order/orderlist.html',
                       reload:true,
                      slidBackEnabled:false,
                      delay:150,
                      animation:{
                        type:"fade",
                        subType:"from_bottom",
                    }

                  })



             }
             else
             {
               $("#status57").css("display","block");
             api.alert({
                  title: '修改失败'
              });
             }
      }
  });
}
function submit7()
{
  $("#status57").css("display","none");
  var strArr_aa=document.getElementById("simg7").getElementsByTagName('IMG');
  if(strArr_aa.length==0)
  {
     api.alert({
            title: '请上传照片'
        });
          $("#status57").css("display","block");
    return false;
  }



  var uid_el=document.getElementById("uid");
var  uid=$api.val(uid_el);
s_updateimg_kz88(uid);
}

function submit7bc()
{
  $("#status57").css("display","none");
submit788status();
}

//卸货
// function submit7()
// {
//
//   var strArr_aa=document.getElementById("simg7").getElementsByTagName('IMG');
//   if(strArr_aa.length==0)
//   {
//      api.alert({
//             msg: '请上传照片'
//         });
//     return false;
//   }
//
//   // if($("#simg7").html()=="")
//   // {
//   //  api.alert({
//   //         msg: '请上传图片'
//   //     });
//   // return false;
//   // }
//
//   var uid_el=document.getElementById("uid");
// var  uid=$api.val(uid_el);
// //console.log(uid);
//   api.ajax({
//       url: functionURL + 'wayBillScreen/unload.json',
//       dataType:'text',
//       headers:
//       {
//
//         login_token:$api.getStorage('loginToken')
//       },
//       method: 'post',
//       data: {
//           values: {
//               waybillId: uid,
//             //  status:8
//           },
//           files: {
//               file: 'fs://a.gif'
//           }
//       }
//   }, function(ret, err) {
//       if (ret) {
//
//         if(ret==1){
//           api.alert({
//                msg: '修改成功'
//            });
//
//            var ToDistrict_el=document.getElementById("ToDistrict");
//              var  ToDistrict=$api.val(ToDistrict_el);
//
//              //serverSendMessage8(ToDistrict,uid)
//
// setTimeout(function() {
// s_updateimg_kz(uid);
//   }, 100) ;
//         // api.openWin({
//         //            name : 'order_orderlist',
//         //            url : '../order/orderlist.html',
//         //             reload:true,
//         //            slidBackEnabled:false,
//         //            delay:150,
//         //            animation:{
//         //              type:"fade",
//         //              subType:"from_bottom",
//         //          }
//         //
//         //        })
//              }
//       }
//   });
// }

apiready = function(){


  if($api.getStorage('dy'+$api.getStorage('usid'))==1)
  {

   api.ajax({
  		 url: functionURL + 'wayBillScreen/getListForApp.json',
  		 method: 'get',
  		 headers:
  		 {

  			 login_token:$api.getStorage('loginToken')
  		 },
  		 data: {
  				 values: {
  						 uid:$api.getStorage('yx_uid')
  				 },
  				 files: {
  						 file: 'fs://a.gif'
  				 }
  		 }
   }, function(ret, err) {
  		 if (ret) {

  									 if( ret['data'].length>0){
  							 var item = ret['data'][0];
  							 if(item['status']>4)
  							 {
                   api.execScript({
                         name: 'root',
                   script: 'closeroot();'
                   });

                   $api.rmStorage('yunshuid'+$api.getStorage('usid'))
                   $api.rmStorage('dy'+$api.getStorage('usid'));
                   $api.rmStorage('yx_uid')
  									}


  								}
  						}
  				});

  }


  $api.setStorage('4imgid',0);
    var sid = api.pageParam.id;
var openxz_el=document.getElementById("openxz");
    var uid_el=document.getElementById("uid");
    var ToDistrict_el=document.getElementById("ToDistrict");
    $api.val(uid_el,sid);
    console.log(sid);
    api.ajax({
        url: functionURL + 'wayBillScreen/getListForApp.json',
        method: 'get',
        headers:
        {

          login_token:$api.getStorage('loginToken')
        },
        data: {
            values: {
                uid: sid
            },
            files: {
                file: 'fs://a.gif'
            }
        }
    }, function(ret, err) {
        if (ret) {
//console.log(JSON.stringify(ret));
      if( ret['data'].length>0){
  var item = ret['data'][0];
           var html = '';
           var order_detail_el=document.getElementById("order_detail");

$api.val(ToDistrict_el,item['toDistrict']);
           html+='<div class="tab-bg container ">';
          html+='<div class="row">';
               html+='<div class="col-xs-9">';
                 html+='<div class="tab-font1"><strong>订单号：'+item['waybillUuid']+'</strong></div>';
               html+='</div>';
               html+='<div class="col-xs-3">';

               var str_color;
               var statusdd=0;
               if(item['status']==2)
               {
                  str_color="tab-y-color5";
                  statusdd=1;
               }
              else  if(item['status']==3)
                {
                   str_color="tab-y-color5";
                     statusdd=1;
                }
                else if(item['status']==4)
                {
                   str_color="tab-y-color5";
                  statusdd=1;
                }
                else if(item['status']==6)
                {
                   str_color="tab-y-color5";
                  statusdd=1;
                }
                else if(item['status']==10)
                {
                   str_color="tab-y-color5";
                    statusdd=1;
                }
                 else {
                  str_color="tab-y-color1";
                 }

                 html+='<div class="tab-y '+str_color+'">'+item['statusName']+'</div>';
               html+='</div>';
            html+=' </div>';
             html+='<div class="row tab-sx">';
               html+='<div class="col-xs-6"> <span class="tab-f">发</span><span class="tab-font2">'+item['fromName']+'</span> </div>';
               html+='<div class="col-xs-6"> <span class="tab-f">收</span><span class="tab-font2">'+item['toName']+'</span> </div>';
             html+='</div>';
             html+='<div class="row">';
               html+='<div class="col-xs-7">';
                 html+='<div class="tab-font1">运砂船:'+item['boatName']+' <bdi onclick="openguiji('+item['waybillUuid']+')" style="color:#178aff">查看轨迹</bdi></div>';
               html+='</div>';
               html+='<div class="col-xs-5">';
                 html+='<div class="tab-font1 tab-r stalla">'+item['starttime']+'</div>';
              html+='</div>';
             html+='</div>';
           html+='</div>';
 html+=initNote(item,item['status'],item['sandboatId'],item['boatId'],item['sandplantOwnerId'],statusdd,item['expectTime']);

           html+='<div class="tab-bg container ddxq-t">';
             html+='<div class="row">';
               html+='<div class="col-xs-7 ddxq-font1">';
                 html+='<div><span>订单信息</span></div>';
               html+='</div>';

              //  var lcimg="";
              //  if(item['createType']==2)
              //  {
               //
              //          if(item['sandplantLevel']==1)
              //          {
              //                if(item['status']==2)
              //                {
              //                  lcimg ="liucheng/2/2.png";
              //                }
              //                if(item['status']==3)
              //                {
              //                lcimg ="liucheng/2/3.png";
              //                }
              //                if(item['status']==4)
              //                {
              //                lcimg ="liucheng/2/4.png";
              //                }
              //                if(item['status']==5)
              //                {
              //                lcimg ="liucheng/2/5.png";
              //                }
              //                if(item['status']==6)
              //                {
              //                lcimg ="liucheng/2/6.png";
              //                }
              //                if(item['status']==7)
              //                {
              //                lcimg ="liucheng/2/7.png";
              //                }
              //                if(item['status']==10)
              //                {
              //                lcimg ="liucheng/2/8.png";
              //                }
               //
              //                if(item['status']==8)
              //                {
              //                lcimg ="liucheng/2/9.png";
              //                }
               //
              //                if(item['status']==9)
              //                {
              //                lcimg ="liucheng/2/10.png";
              //                }
              //          }
              //          else {
               //
              //                if(item['status']==2)
              //                {
              //                  lcimg ="liucheng/4/2.png";
              //                }
              //                if(item['status']==3)
              //                {
              //                lcimg ="liucheng/4/3.png";
              //                }
              //                if(item['status']==4)
              //                {
              //                lcimg ="liucheng/4/4.png";
              //                }
              //                if(item['status']==5)
              //                {
              //                lcimg ="liucheng/4/5.png";
              //                }
              //                if(item['status']==7)
              //                {
              //                lcimg ="liucheng/4/6.png";
              //                }
              //                if(item['status']==7)
              //                {
              //                lcimg ="liucheng/4/7.png";
              //                }
              //                if(item['status']==10)
              //                {
              //                lcimg ="liucheng/4/10.png";
              //                }
               //
              //                if(item['status']==8)
              //                {
              //                lcimg ="liucheng/4/8.png";
              //                }
               //
              //                if(item['status']==9)
              //                {
              //                lcimg ="liucheng/4/9.png";
              //                }
               //
              //          }
              //  }
              //  else {
               //
              //            if(item['sandplantLevel']==1)
              //            {
              //                if(item['status']==2)
              //                {
              //                  lcimg ="liucheng/1/1.png";
              //                }
              //                if(item['status']==3)
              //                {
              //                lcimg ="liucheng/1/2.png";
              //                }
              //                if(item['status']==4)
              //                {
              //                lcimg ="liucheng/1/3.png";
              //                }
              //                if(item['status']==5)
              //                {
              //                lcimg ="liucheng/1/4.png";
              //                }
              //                if(item['status']==6)
              //                {
              //                lcimg ="liucheng/1/5.png";
              //                }
              //                if(item['status']==7)
              //                {
              //                lcimg ="liucheng/1/6.png";
              //                }
              //                if(item['status']==10)
              //                {
              //                lcimg ="liucheng/1/7.png";
              //                }
               //
              //                if(item['status']==8)
              //                {
              //                lcimg ="liucheng/1/8.png";
              //                }
               //
              //                if(item['status']==9)
              //                {
              //                lcimg ="liucheng/1/9.png";
              //                }
              //            }
              //            else {
               //
               //
              //                    if(item['status']==2)
              //                    {
              //                      lcimg ="liucheng/3/2.png";
              //                    }
              //                    if(item['status']==3)
              //                    {
              //                    lcimg ="liucheng/3/3.png";
              //                    }
              //                    if(item['status']==4)
              //                    {
              //                    lcimg ="liucheng/3/4.png";
              //                    }
              //                    if(item['status']==5)
              //                    {
              //                    lcimg ="liucheng/3/5.png";
              //                    }
              //                    if(item['status']==6)
              //                    {
              //                    lcimg ="liucheng/3/6.png";
              //                    }
              //                    if(item['status']==7)
              //                    {
              //                    lcimg ="liucheng/3/7.png";
              //                    }
              //                    if(item['status']==10)
              //                    {
              //                    lcimg ="liucheng/3/10.png";
              //                    }
               //
              //                    if(item['status']==8)
              //                    {
              //                    lcimg ="liucheng/3/8.png";
              //                    }
               //
              //                    if(item['status']==9)
              //                    {
              //                    lcimg ="liucheng/3/9.png";
              //                    }
               //
              //            }
              //  }

                            html+='<div class="col-xs-5 ddxq-font22" onmousedown=ondown_lc("'+initliuchengimg(item)+'","'+item['statusName']+'",'+item['uid']+')>';
                              html+='<div><span>查看流程图</span></div>';
                            html+='</div>';


             html+='</div>';
             html+='<div class="row ddxq-l">';
               html+='<div class="col-xs-4 ddxq-font2"> 订单号： </div>';
               html+='<div class="col-xs-8 ddxq-font3"> '+item['waybillUuid']+' </div>';
             html+='</div>';
             html+='<div class="row ddxq-l">';
               html+='<div class="col-xs-4 ddxq-font2"> 运砂船： </div>';
               html+='<div class="col-xs-8 ddxq-font3" onclick="opentelboat('+item['boatId']+')"><span class="glyphicon glyphicon-earphone icphone"></span> '+item['boatName']+'</div>';
             html+='</div>';

             if(item['createType']==2)
             {
               var sccf="方";
             }
             else {
               var sccf="吨";
             }

             html+='<div class="row ddxq-l">';
               html+='<div class="col-xs-4 ddxq-font2"> 运砂量： </div>';
               html+='<div class="col-xs-8 ddxq-font3"> '+item['weight']+sccf+' ('+item['sandtype']+')</div>';
             html+='</div>';
             html+='<div class="row ddxq-l">';
               html+='<div class="col-xs-4 ddxq-font2"> 核定运砂量： </div>';
               html+='<div class="col-xs-8 ddxq-font3" class="cff" style="color:#178aff"> '+item['realWeight']+'吨 </div>';
             html+='</div>';

             var eatWaterLineaa="";
             if(item['eatWaterLine']!=null)
             {
               eatWaterLineaa=item['eatWaterLine'];
               html+='<div class="row ddxq-l" >';
                 html+='<div class="col-xs-4 ddxq-font2" > 减载高度： </div>';
                 html+='<div class="col-xs-8 ddxq-font3 " > '+eatWaterLineaa+'cm </div>';
               html+='</div>';
             }
             else {
               //eatWaterLineaa="0.0";
             }

             var containWateraa="";
             if(item['containWater']!=null)
             {
               containWateraa=item['containWater'];
               html+='<div class="row ddxq-l" >';
                 html+='<div class="col-xs-4 ddxq-font2" > 含水系数： </div>';
                 html+='<div class="col-xs-8 ddxq-font3 " > '+containWateraa+'% </div>';
               html+='</div>';
             }
             else {
          //     containWateraa="0.0";
             }



             html+='<div class="row ddxq-l">';
               html+='<div class="col-xs-4 ddxq-font2"> 采砂船： </div>';
               html+='<div class="col-xs-8 ddxq-font3" onclick="opentelsandboat('+item['sandboatId']+')"><span class="glyphicon glyphicon-earphone icphone"></span> '+item['sandboatName'];

               if(item['sandboatRemark']!=null)
               {

                              html+=' ('+item['sandboatRemark']+')';

               }

                html+='</div>';
             html+='</div>';
             html+='<div class="row ddxq-l">';
               html+='<div class="col-xs-4 ddxq-font2"> 发货员： </div>';
               html+='<div class="col-xs-8 ddxq-font3" onclick="openteldeliver('+item['deliver']+')"><span class="glyphicon glyphicon-earphone icphone"></span> '+item['deliverName']+'</div>';
             html+='</div>';

             html+='<div class="row ddxq-l">';
               html+='<div class="col-xs-4 ddxq-font2"> 采区： </div>';
               html+='<div class="col-xs-8 ddxq-font3"> '+item['fromName'];

              //  if(item['sandboatRemark']!=null)
              //  {
               //
              //                 html+=' ('+item['sandboatRemark']+')';
               //
              //  }

               html+='</div>';
             html+='</div>';




             html+='<div class="row ddxq-l">';
               html+='<div class="col-xs-4 ddxq-font2"> 砂场： </div>';
              // html+='<div class="col-xs-8 ddxq-font3"> '+item['toName']+'</div>';
                           html+='<div class="col-xs-8 ddxq-font3" onclick=opentelsandplantOwner('+item['sandplantOwnerId']+')><span class="glyphicon glyphicon-earphone icphone"></span> '+item['toName'];

                           if(item['sandplantRemark']!=null)
                           {

                                          html+=' ('+item['sandplantRemark']+')';

                           }

                           html+='</div>';
             html+='</div>';



             if(item['sandplantLevel']==2)
             {

               html+='<div class="row ddxq-l">';
                 html+='<div class="col-xs-4 ddxq-font2"yiji >一级砂场： </div>';
                             html+='<div class="col-xs-8 ddxq-font3" onclick=opentelparentSandplantOwner('+item['parentSandplantOwnerId']+')><span class="glyphicon glyphicon-earphone icphone"></span> '+item['parentSandplantName']+' </div>';
               html+='</div>';
             }

                           if(item['sandplantAux1']!=null)
                          {
                                       html+='<div class="row ddxq-l">';
                                         html+='<div class="col-xs-4 ddxq-font2"> 辅测人员1： </div>';
                                         html+='<div class="col-xs-8 ddxq-font3" onclick=opentelfc('+item['sandplantAux1']+',"辅测人员1")><span class="glyphicon glyphicon-earphone icphone"></span> '+item['sandplantAux1Name']+' </div>';
                                       html+='</div>';

                          }

                          if(item['sandplantAux2']!=null)
                          {
                                      html+='<div class="row ddxq-l">';
                                        html+='<div class="col-xs-4 ddxq-font2"> 辅测人员2： </div>';
                                        html+='<div class="col-xs-8 ddxq-font3" onclick=opentelfc('+item['sandplantAux2']+',"辅测人员1")><span class="glyphicon glyphicon-earphone icphone"></span> '+item['sandplantAux2Name']+' </div>';
                                      html+='</div>';

                          }

                          if(item['sandplantManager']!=null)
                          {
                                      html+='<div class="row ddxq-l">';
                                        html+='<div class="col-xs-4 ddxq-font2"> 负责人： </div>';
                                        html+='<div class="col-xs-8 ddxq-font3" onclick=opentelfc('+item['sandplantManager']+',"负责人")><span class="glyphicon glyphicon-earphone icphone"></span> '+item['sandplantManagerName']+' </div>';
                                      html+='</div>';

                          }

         if(item['accepttime']!=null)
               {
                 html+='<div class="row ddxq-l">';
                   html+='<div class="col-xs-4 ddxq-font2"> 收货时间： </div>';
                   html+='<div class="col-xs-8 ddxq-font3"> '+item['accepttime']+' </div>';
                 html+='</div>';

            // html+='<div>收货时间：'+item['accepttime']+'</div>';
            }

            html+='<div class="row">';
              html+='<div class="col-xs-12 ddxq-font1">';
                html+='<div><span>装载照片</span></div>';
              html+='</div>';
              html+='<div class="row ddxq-picw">';

               if(item['fullpicture']!=null)
               {
                         $api.setStorage('fullpicture', item['fullpicture']);
                 var fullpicture=item['fullpicture'].split(",");

                 for (i = 0; i < fullpicture.length; i++) {
                      //console.log(strArr[i]);
                      html+='<div class="col-xs-4">';
      html+='<a class="ddxq-pic" onmousedown=ondown("'+fullpicture[i]+'")> <img src="" alt="" id="sssa'+i+'"></a>';
                      // html+='<a href="#" class="ddxq-pic"  onmousedown=ondown("'+fullpicture[i]+'")> <img src="'+functionURLimg+fullpicture[i]+'" alt=""> </a>';
                      html+='</div>';

                  }

               }

              html+='</div>';
            html+='</div>';


            if(item['unloadpicture']!=null)
            {
                 $api.setStorage('unloadpicture', item['unloadpicture']);
              html+='<div class="row">';
              html+='<div class="col-xs-12 ddxq-font1">';
              html+='<div><span>卸货前装载照片</span></div>';
              html+='</div>';
              html+='<div class="row ddxq-picw">';


                 var unloadpicture=item['unloadpicture'].split(",");

                 for (i = 0; i < unloadpicture.length; i++) {
                      //console.log(strArr[i]);
                      html+='<div class="col-xs-4">';

                       //html+='<a href="#" class="ddxq-pic"  onmousedown=ondown("'+emptypicture[i]+'")> <img src="'+functionURLimg+emptypicture[i]+'" alt=""> </a>';
                         html+='<a href="#" class="ddxq-pic"  onmousedown=ondown("'+unloadpicture[i]+'")> <img src="" alt="" id="sssc'+i+'"> </a>';
                      html+='</div>';

                  }



              html+='</div>';
              html+='</div>';
            }


            if(item['emptypicture']!=null)
            {
               $api.setStorage('emptypicture', item['emptypicture']);
              html+='<div class="row">';
              html+='<div class="col-xs-12 ddxq-font1">';
              html+='<div><span>卸货照片</span></div>';
              html+='</div>';
              html+='<div class="row ddxq-picw">';


                 var emptypicture=item['emptypicture'].split(",");

                 for (i = 0; i < emptypicture.length; i++) {
                      //console.log(strArr[i]);
                      html+='<div class="col-xs-4">';

                      // html+='<a href="#" class="ddxq-pic"  onmousedown=ondown("'+emptypicture[i]+'")> <img src="'+functionURLimg+emptypicture[i]+'" alt=""> </a>';
                          html+='<a href="#" class="ddxq-pic"  onmousedown=ondown("'+emptypicture[i]+'")> <img src="" alt="" id="sssb'+i+'"> </a>';
                      html+='</div>';

                  }



              html+='</div>';
              html+='</div>';
            }
            else {
if(item['status']==10){

                  html+='<div class="row">';
                    html+='<div class="col-xs-12 ddxq-font1">';
                      html+='<div><span>卸货照片</span>';

                      html+='</div>';
                    html+='</div>';


                  html+='<div class="row ddxq-picw" id="simg7"><div class="col-xs-4"  onclick="opencama()" >  <a  class="ddxq-pic-cc"   ></a> </div></div>';
                html+='</div>';

}
            }




                  //  html+='<div class="row">';
                  //    html+='<div class="col-xs-12 ddxq-font1">';
                  //      html+='<div><span>装载照片</span></div>';
                  //    html+='</div>';
                  //    html+='<div class="row ddxq-picw">';
                  //      html+='<div class="col-xs-4"> <a href="#" class="ddxq-pic"> <img src="image/sto.png" alt=""> </a> </div>';
                   //
                  //    html+='</div>';
                  //  html+='</div>';
          //  html+='<div class="row">';
          //      html+='<div class="col-xs-12 ddxq-font1">';
          //        html+='<div><span>卸货照片</span></div>';
          //      html+='</div>';
          //      html+='<div class="row ddxq-picw">';
          //        html+='<div class="col-xs-4"> <a href="#" class="ddxq-pic"> <img src="image/sto.png" alt=""> </a> </div>';
           //
          //      html+='</div>';
          //    html+='</div>';
           html+='</div>';

           if(item['status']==3)
           {
             html+='<div class="ddxq-btn" id="sys1a">';
             html+='<button type="button"  onClick="submit4()" id="ys" >确认并开始运输</button>';
             html+='</div>';

            //  html+='<button type="button" class="btn btn-danger" onClick="submit4()" style="color:#ffffff" >确认运输</button>';


           }


                      if(item['status']==4)
                      {

           if($api.getStorage('yunshuid'+$api.getStorage('usid'))==sid)
           {//var sta="结束运输并卸货";
           html+='<div class="ddxq-btn" id="sys1">';
           html+='<button type="button" onClick="ysa2('+sid+')" id="ys" >结束运输并卸货</button>';
           html+='</div>';
         }

           else {
              //var sta="确认并开始运输";
              html+='<div class="ddxq-btn" id="sys1">';
              html+='<button type="button" onClick="ysa1('+sid+')" id="ys" >确认并开始运输</button>';
              html+='</div>';
           }




                          //  html+='<button type="button" class="btn btn-danger" onClick="ys0()" style="color:#ffffff" id="ys" >'+sta+'</button>';


                      }

           //
          //  if(item['status']==4)
          //  {
           //
          //    //console.log(1);
          //  $api.css(openxz_el,'display:block');
           //
          //    if($api.getStorage('yunshu')==1)
          //    {var sta="开始运输";}
          //    else if($api.getStorage('yunshu')==2){
          //      var sta="结束运输";
          //    }
          //    else {
          //       var sta="确认并开始运输";
          //    }
           //
          //       html+='<div class="ddxq-btn" id="sys1">';
          //       html+='<button type="button" onClick="ys0a()" id="ys" >'+sta+'</button>';
          //       html+='</div>';
           //
          //   //  html+='<button type="button" class="btn btn-danger" onClick="ys0()" style="color:#ffffff" id="ys" >'+sta+'</button>';
           //
          //  }

          if(item['status']==2)
          {
             html+='<div class="ddxq-btn"  id="status52">';
             html+='<button type="button" onClick="submit5()">确认</button>';
             html+='</div>';
          }
            if(item['status']==6)
            {
              html+='<div class="ddxq-btn">';
              html+='<button type="button" onClick="submit6()" >确认运砂量</button>';
              html+='</div>';

              // html+='<button type="button" class="btn btn-danger" onClick="submit6()" style="color:#ffffff" >确认运沙量</button>';
            }

            if(item['status']==10)
            {
                   var opencama_el=document.getElementById("opencama");
                   $api.css(opencama_el,"display:block");
              //html+='卸货照片';
              if(item['emptypicture']!=null)
              {
                html+='<div class="ddxq-btn" id="status57">';
                html+='<button type="button" onClick="submit7bc()"  >卸货并上传照片</button>';
                html+='</div>';

              }
              else {
                html+='<div class="ddxq-btn" id="status57">';
                html+='<button type="button" onClick="submit7()"  >卸货并上传照片</button>';
                html+='</div>';
              }


              // html+='<button type="button" class="btn btn-danger" onClick="submit7()" style="color:#ffffff" >确认</button>';
            }
            if(item['status']>7&&item['status']<9)
            {
              var bczpaa_el=document.getElementById("bczpaa");
              $api.css(bczpaa_el,"display:block");

            }

            // if(item['status']==2)
            // {
            //    html+='<div class="ddxq-btn">';
            //    html+='<button type="button" onClick="submit5()">确认</button>';
            //    html+='</div>';
            // }

                $api.html(order_detail_el,html);


//            html+='<div>订单号：'+item['waybillUuid']+'|'+item['statusName']+'</div>';
//            html+='<div>发：'+item['fromName']+'|收'+item['toName']+'|'+item['starttime']+'</div>';
//            html+='<div  style="height:10px;"></div>';
//            html+='<div>'+item['waybillUuid']+'</div>';
//            html+='<div>运砂船：'+item['boatName']+'</div>';
//            html+='<div>运砂量：'+item['weight']+'</div>';
//            html+='<div>核定运沙量：'+item['realWeight']+'</div>';
//            html+='<div>采砂船：'+item['sandboatName']+'</div>';
//            html+='<div>发货员：'+item['deliverName']+'</div>';
//            html+='<div>发货时间：'+item['starttime']+'</div>';
//            html+='<div>采区：'+item['fromName']+'</div>';
//            html+='<div>砂厂：'+item['toName']+'</div>';
//
//
//           // console.log(item['accepttime']);
//            if(item['accepttime'] == ''|| item['accepttime']!=null)
//            {
//            html+='<div>收货时间：'+item['accepttime']+'</div>';
//            }
//
//            if(item['status']==3)
//            {
//
//              html+='<button type="button" class="btn btn-danger" onClick="submit4()" style="color:#ffffff" >确认运输</button>';
//
//
//            }
//
//
//            if(item['status']==4)
//            {
//
//              //console.log(1);
// $api.css(openxz_el,'display:block');
//
//              if($api.getStorage('yunshu')==1)
//              {var sta="开始运输";}
//              else if($api.getStorage('yunshu')==2){
//                var sta="结束运输";
//              }
//              else {
//                 var sta="确认并开始运输";
//              }
//
//              html+='<button type="button" class="btn btn-danger" onClick="ys0()" style="color:#ffffff" id="ys" >'+sta+'</button>';
//
//            }
//
//
//             if(item['status']==6)
//             {
//               html+='<button type="button" class="btn btn-danger" onClick="submit6()" style="color:#ffffff" >确认运沙量</button>';
//             }
//
//             if(item['status']==7)
//             {
//                    var opencama_el=document.getElementById("opencama");
//                    $api.css(opencama_el,"display:block")
//               html+='卸货照片';
//               html+='<button type="button" class="btn btn-danger" onClick="submit7()" style="color:#ffffff" >确认</button>';
//             }
//
//                 $api.html(order_detail_el,html);
              }

              if(item['fullpicture']!=null){
                imageCache_a();
              }
                  if(item['emptypicture']!=null){
                imageCache_b();
              }

            setTimeout(function() {

              if(item['unloadpicture']!=null){
            imageCache_c();
          }



        }, 300) ;

        }
    });
};
</script>
</html>
