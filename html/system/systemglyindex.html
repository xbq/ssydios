<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
    <meta name="format-detection" content="telephone=no,email=no,date=no,address=no">
    <title>沙石运单</title>
    <link rel="stylesheet" type="text/css" href="../../css/api.css"/>
    <link rel="stylesheet" type="text/css" href="../../css/style.css"/>
	<link rel="stylesheet" type="text/css" href="../../css/bootstrap.css">
  <link rel="stylesheet" type="text/css" href="../../css/scCss.css">
  <script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/common.js"></script>
  <script type="text/javascript" src="../../script/jquery.min.js"></script>
  <script type="text/javascript" src="../../script/bootstrap.min.js"></script>
  <script type="text/javascript" src="../../script/map.js"></script>
  <script type="text/javascript" src="../../script/mapzh.js"></script>


</head>

<style>


</style>
<body>

  <div id="wrap" class="flex-wrap flex-vertical">
    <div class="container grad" style=" padding-top:0">
        <div class="i20"></div>
      <div class="row">
        <div class="col-xs-3 font1"> </div>
        <div class="col-xs-6 font2"> 个人中心 </div>
        <div class="col-xs-3 font3" onclick="opensz()"> <img src="../../image/ssz.png"> </div>
      </div>
      <div style="clear: both"></div>
      <div class="row gr-sx" style=" padding-top:0">
        <div class="col-xs-6" style="padding-right:0;z-index:198">
            <div style="width:35%;float:left; z-index:1000000" onClick="aaaaa()"><img src="../../image/smy.png"  id="smyaaimg" style="width:100%; height:auto; max-width:50px"/></div>
            <div style="width:65%;float:left; padding-top:5px;padding-left:5px; color:#fff "><span class="font311" id="usname"></span><br/><span class="font311" style="font-size:14px;" id="ro_name"></span></div>
<!-- <table width="100%" border="0">
  <tr>
    <td width="40%"  valign="top"><img src="../../image/smy.png"  style="width:100%; height:auto; max-width:50px"/></td>
    <td width="60%" valign="top" style="padding-top:30px;"><span class="font3" id="usname"></span><br/><span class="font3" style="font-size:14px;" id="ro_name"></span></td>

  </tr>
</table> -->
          <!-- <img src="../../image/smy.png"><span class="font3" id="usname"></span><br/><span class="font3" style=" padding-left:23%; font-size:14px;" id="ro_name"></span> -->
        </div>
        <div class="col-xs-6" onclick="opencsc()" style="padding-top:10px;padding-left:0;"><span class="font4" id="uroles"></span> </div>
      </div>
    </div>

  	<div id="main" class="flex-con" >
      <div class="tab-bg container" style="padding-top:0px;margin-top:16px;padding-bottom:0px;margin-bottom:16px;">
        <div class="row gr-lb" onclick="openmima()" >
          <div class="col-xs-6">
            <img src="../../image/s02.png"><span id="dqbb">修改密码</span>
          </div>
          <div class="col-xs-6 gr-r">

          </div>
        </div>
      </div>

  		<div class="tab-bg container">
  			<div class="row gr-lb">
  				<div class="col-xs-6">
  					<img src="../../image/sbb.png"><span id="dqbb">当前版本</span>
  				</div>
  				<div class="col-xs-6 gr-r" id="appVersion">
  					1.0
  				</div>
  			</div>
  			<div class="row gr-lb">
  				<div class="col-xs-6 ">
  					<img src="../../image/skf.png"><span>开发单位</span>
  				</div>
  				<div class="col-xs-6 gr-r">
  					广州中海达
  				</div>
  			</div>
  			<div class="row gr-lb">
  				<div class="col-xs-6">
  					<img src="../../image/syj.png"><span>意见反馈</span>
  				</div>
  				<div class="col-xs-6">
  				</div>
  			</div>
  			<div class="row gr-lb">
  				<div class="col-xs-6" onClick="opengy()">
  					<img src="../../image/sgy.png"><span>关于应用</span>
  				</div>
  				<div class="col-xs-6">
  				</div>
  			</div>
  		</div>
  		<div class="gr-btn">
  			<button type="button" onClick="tuic()">退出登录</button>
  		</div>
  	</div>

    <!-- <div id="footer" class="border-t">
       <ul class="flex-wrap" >
         <li tapmode="hover" onClick="randomS(0)" class="flex-con " >今日订单</li>
         <li tapmode="hover" onClick="randomS(1)" class="flex-con" >历史订单</li>
         <li tapmode="hover" onClick="randomS(2)" class="flex-con active" >个人中心</li>
       </ul>
   </div> -->

  </div>

  <!-- <div id="wrap" class="flex-wrap flex-vertical">

    <div id="header_s">
        <ul>
            <li class="border-b active" >个人中心</li>
        </ul>
    </div>


    <div id="main" class="flex-con" >

      <button type="button" class="btn btn-danger" onClick="subexits_sz()" style="color:#ffffff">注销</button>

    </div>

     <div id="footer" class="border-t">
        <ul class="flex-wrap" >
          <li tapmode="hover" onClick="randomS(0)" class="flex-con " >今日订单</li>
          <li tapmode="hover" onClick="randomS(1)" class="flex-con" >历史订单</li>
          <li tapmode="hover" onClick="randomS(2)" class="flex-con active" >个人中心</li>
        </ul>
    </div>

</DIV> -->
</body>
</html>


</body>
<script>
function fsread()
{
  window.location.reload();
}
function tuic()
{

  api.closeWin({
      name: 'glylist'
  });
  api.closeWin({
      name: 'order_csc08'
  });
  api.closeWin({
      name: 'pqglylist'
  });

// api.closeFrame({
//     name: 'glyindex'
// });
//   $api.setStorage('glyjryda',0);
// $api.setStorage('pqglyjryda',0);
// $api.rmStorage('pianquid');
// $api.rmStorage('pianqname');
subexits_sz();


}
function opengy()
{

  api.openWin({

                 name : 'system_gy',
                 url : '../system/gy.html',
                 slidBackEnabled:false,
                 reload:true,
              //    animation:{
              //      type:"fade",
              //      subType:"from_bottom",
              //  }

         });
}

function openmima()
{
  api.openWin({

                 name : 'system_mima',
                 url : '../system/mima.html',
                 slidBackEnabled:false,
                 reload:true,
                 animation:{
                   type:"fade",
                   subType:"from_bottom",
               }

         });

}

function opencsc()
{

  // api.closeFrame({
  //     name: 'order_orderhistory'
  // });
  // api.closeFrame({
  //     name: 'system_index'
  // });

  // api.closeWin({
  //     name: 'order_orderlist'
  // });

  if($api.getStorage('uroles')=='采砂船管理员')//采沙管理员
  {
     api.openWin({

                    name : 'order_csc06',
                    url : '../order/csc06.html',
                    slidBackEnabled:false,
                    reload:true,
                    animation:{
                      type:"fade",
                      subType:"from_bottom",
                  }

            });

  }

  if($api.getStorage('uroles')=='采区负责人')//采区负责人
  {
     api.openWin({

                    name : 'order_csc06',
                    url : '../order/csc06.html',
                    slidBackEnabled:false,
                    reload:true,
                    animation:{
                      type:"fade",
                      subType:"from_bottom",
                  }

            });

  }

  if($api.getStorage('uroles')=='片区负责人')//采区负责人
  {
     api.openWin({

                    name : 'order_csc08',
                    url : '../order/csc08.html',
                    slidBackEnabled:false,
                    reload:true,
                    animation:{
                      type:"fade",
                      subType:"from_bottom",
                  }

            });

  }

  else if($api.getStorage('uroles')=='砂场收货员')//沙场收货员
  {
     api.openWin({

                    name : 'order_csc03',
                    url : '../order/csc03.html',
                    slidBackEnabled:false,
                    reload:true,
                    animation:{
                      type:"fade",
                      subType:"from_bottom",
                  }

            });

  }

}
// function mapdw()
// {
// 	api.toast({
// 			msg: '开始定位',
// 			duration: 2000,
// 			location: 'middle'
// 	});
// 	getLocation4(trace_interval, trace_accuracy, trace_filter,uid);
// }
function opensz()
{
  api.openWin({

                 name : 'system_sz',
                 url : '../system/sz.html',
                 slidBackEnabled:false,
                 reload:true,
              //    animation:{
              //      type:"fade",
              //      subType:"from_bottom",
              //  }

         });
}
   apiready = function () {



          if($api.getStorage('picturePath')!=null)
          {


            var imgurl=functionURLimg+$api.getStorage('picturePath');

             api.imageCache({
                 url: imgurl,
                // policy: 'cache_else_network'
             }, function(ret, err) {
                 if (ret.status) {
                 console.log(ret.url);

                   document.getElementById("smyaaimg").src = ret.url;
                  //   ele_.src = ret.url;
              //       $api.removeAttr(ele_, 'data-url');
                 }
             });
          }


     $api.fixTabBar($api.byId('footer'));
var appVersion = api.appVersion;
     var appVersion_el=document.getElementById("appVersion");
       $api.html(appVersion_el,appVersion);

    //  console.log(   $api.getStorage('s_cid'));
    //   console.log(  "aa");//登录ID);
     var usname_el=document.getElementById("usname");
     var uroles_el=document.getElementById("uroles");
 var ro_name_el=document.getElementById("ro_name");

  if($api.getStorage('uroles')=='采砂船管理员')//采沙管理员
  {
    $api.html(ro_name_el,$api.getStorage('ucsc06name'));

  }
  else if($api.getStorage('uroles')=='采砂船船主')//采沙船船主
  {
$api.html(ro_name_el,$api.getStorage('sandboatName'));
  }
  else if($api.getStorage('uroles')=='运砂船船主')//运沙船船主
  {
$api.html(ro_name_el,$api.getStorage('boatName'));
  }
  else if($api.getStorage('uroles')=='砂场收货员')//沙场收货员
  {
$api.html(ro_name_el,$api.getStorage('toDistrictname'));
  }
  else if($api.getStorage('uroles')=='片区负责人')//沙场收货员
  {
$api.html(ro_name_el,$api.getStorage('pianqname'));
  }

  $api.html(usname_el,$api.getStorage('usname'));
    $api.html(uroles_el,$api.getStorage('uroles'));
   }

</script>

<script>
function aaaaa()
{
  api.actionSheet({
      title: '',
      cancelTitle: '取消',
      destructiveTitle: '',
      buttons: ['拍照', '相册']
  }, function(ret, err) {
      var index = ret.buttonIndex;
if(index==1)
{
   takePhoto();
}
else if(index==2){
takePhotoxc();

}


  });
}
function takePhoto() {

       api.getPicture({
           sourceType: 'camera', //（可选项）图片源类型，从相册、图片库或相机获取图片
           encodingType: 'jpg', //（可选项）返回图片类型，jpg或png
           mediaValue: 'pic', //（可选项）媒体类型，图片或视频
           destinationType: 'url', //（可选项）返回数据类型，指定返回图片地址或图片经过base64编码后的字符串
           allowEdit: true,
           quality: 100, //（可选项）图片质量，只针对jpg格式图片（0-100整数）
          targetWidth: 800, //（可选项）压缩后的图片宽度，图片会按比例适配此宽度
          //targetHeight: 800, //（可选项）压缩后的图片高度，图片会按比例适配此高度
           saveToPhotoAlbum: true
       }, function(ret, err) {
           if (ret) {
            //   alert(JSON.stringify(ret));
var imgSrc = ret.data;
var postStr = '"input-id-1":"' + imgSrc + '"';


postStr = "{" + postStr + "}";
 var a = JSON.parse(postStr);
               console.log(JSON.stringify(a));
 api.ajax({
               url: functionURL + 'upLoadScreen/userPicture.json',
               method: 'post',
               headers:
               {

                 login_token:$api.getStorage('loginToken')
               },
               dataType: 'text',
               data: {
                   values: {
                       fileCount: 1,
                       userId: $api.getStorage('usid')
                   },
                   files: a
               }
           }, function(reta, err) {
               if (reta) {




                   //alert(JSON.stringify(ret));
                   console.log(JSON.stringify(reta));


 // //修改订单状态
 if(reta==1){

	//$api.setStorage('picturePath',ret['picturePath']);//登录ID
 console.log("上传成功"+JSON.stringify(reta));
  api.ajax({
    url: functionURL + 'sysUserScreen/find.json',
    method: 'post',
    headers:
    {

      login_token:$api.getStorage('loginToken')
    },
    data: {
        values: {
            userId: $api.getStorage('usid')
        },
        files: {
             file: 'fs://a.gif'
         }
    }
  }, function(retsa, err) {

     console.log("上传成功"+JSON.stringify(retsa));
      if (retsa) {

        if(retsa.picturePath!=null)
        {

          $api.setStorage('picturePath',retsa.picturePath);//登录ID

          var imgurl=functionURLimg+$api.getStorage('picturePath');

           api.imageCache({
               url: imgurl,
              // policy: 'cache_else_network'
           }, function(ret, err) {
               if (ret.status) {
               console.log(ret.url);

                 document.getElementById("smyaaimg").src = ret.url;
                //   ele_.src = ret.url;
            //       $api.removeAttr(ele_, 'data-url');
               }
           });
        }

      } else {

      }
  });




 }
 else {
   api.toast({
 msg: '照片传输失败！请重试',
 duration: 2000,
 location: 'middle'
 });
 }
 // //修改订单状态


               } else {

                 api.toast({
               msg: '照片传输失败！请重试',
               duration: 2000,
               location: 'middle'
               });
                 //  alert(JSON.stringify(err));
               }
           });

           } else {

             api.toast({
           msg: '照片传输失败！请重试',
           duration: 2000,
           location: 'middle'
           });


               //alert(JSON.stringify(err));
           }
       });
   }


   function takePhotoxc() {

          api.getPicture({
              sourceType: 'album', //（可选项）图片源类型，从相册、图片库或相机获取图片
              encodingType: 'jpg', //（可选项）返回图片类型，jpg或png
              mediaValue: 'pic', //（可选项）媒体类型，图片或视频
              destinationType: 'url', //（可选项）返回数据类型，指定返回图片地址或图片经过base64编码后的字符串
              allowEdit: true,
              quality: 100, //（可选项）图片质量，只针对jpg格式图片（0-100整数）
             targetWidth: 800, //（可选项）压缩后的图片宽度，图片会按比例适配此宽度
             //targetHeight: 800, //（可选项）压缩后的图片高度，图片会按比例适配此高度
              saveToPhotoAlbum: true
          }, function(ret, err) {
              if (ret) {
               //   alert(JSON.stringify(ret));
   var imgSrc = ret.data;
   var postStr = '"input-id-1":"' + imgSrc + '"';


   postStr = "{" + postStr + "}";
    var a = JSON.parse(postStr);
                  console.log(JSON.stringify(a));
    api.ajax({
                  url: functionURL + 'upLoadScreen/userPicture.json',
                  method: 'post',
                  headers:
                  {

                    login_token:$api.getStorage('loginToken')
                  },
                  dataType: 'text',
                  data: {
                      values: {
                          fileCount: 1,
                          userId: $api.getStorage('usid')
                      },
                      files: a
                  }
              }, function(reta, err) {
                  if (reta) {




                      //alert(JSON.stringify(ret));
                      console.log(JSON.stringify(reta));


    // //修改订单状态
    if(reta==1){

   	//$api.setStorage('picturePath',ret['picturePath']);//登录ID
    console.log("上传成功"+JSON.stringify(reta));
     api.ajax({
       url: functionURL + 'sysUserScreen/find.json',
       method: 'post',
       headers:
       {

         login_token:$api.getStorage('loginToken')
       },
       data: {
           values: {
               userId: $api.getStorage('usid')
           },
           files: {
                file: 'fs://a.gif'
            }
       }
     }, function(retsa, err) {

        console.log("上传成功"+JSON.stringify(retsa));
         if (retsa) {

           if(retsa.picturePath!=null)
           {

             $api.setStorage('picturePath',retsa.picturePath);//登录ID

             var imgurl=functionURLimg+$api.getStorage('picturePath');

              api.imageCache({
                  url: imgurl,
                 // policy: 'cache_else_network'
              }, function(ret, err) {
                  if (ret.status) {
                  console.log(ret.url);

                    document.getElementById("smyaaimg").src = ret.url;
                   //   ele_.src = ret.url;
               //       $api.removeAttr(ele_, 'data-url');
                  }
              });
           }

         } else {

         }
     });




    }
    else {
      api.toast({
    msg: '照片传输失败！请重试',
    duration: 2000,
    location: 'middle'
    });
    }
    // //修改订单状态


                  } else {

                    api.toast({
                  msg: '照片传输失败！请重试',
                  duration: 2000,
                  location: 'middle'
                  });
                    //  alert(JSON.stringify(err));
                  }
              });

              } else {

                api.toast({
              msg: '照片传输失败！请重试',
              duration: 2000,
              location: 'middle'
              });


                  //alert(JSON.stringify(err));
              }
          });
      }

</script>
</html>
