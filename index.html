<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
<title>会员登录</title>
<link rel="stylesheet" type="text/css" href="./css/api.css"/>
<link rel="stylesheet" type="text/css" href="./css/style.css"/>
<link rel="stylesheet" type="text/css" href="./css/bootstrap.css">
<link rel="stylesheet" type="text/css" href="./css/scCss.css">
<style>
#footer{  background-color: #f2f2f2; }
#footer ul li{  padding-top: 36px; padding-bottom: 4px; background: url() no-repeat center 2px; background-size: auto 30px; text-align: center; }
#footer ul li.active{ color: #6ab494; }
#footer ul li:nth-child(1){ background-image: url(../../image/bottombtn0101.png); }
#footer ul li:nth-child(2){ background-image: url(../../image/bottombtn0201.png); }
#footer ul li:nth-child(3){ background-image: url(../../image/bottombtn0301.png); }
#footer ul li:nth-child(4){ background-image: url(../../image/bottombtn0401.png); }
#footer ul li:nth-child(1).active{ background-image: url(../../image/bottombtn0102.png); }
#footer ul li:nth-child(2).active{ background-image: url(../../image/bottombtn0202.png); }
#footer ul li:nth-child(3).active{ background-image: url(../../image/bottombtn0302.png); }
#footer ul li:nth-child(4).active{ background-image: url(../../image/bottombtn0402.png); }
</style>
<style>

#back_divaa{ width:100%; height:100%; position: fixed; left:0; top:0; z-index:998;
background-color:rgba(0,0,0,.3);
/*background:#fff;*/
display: none
}
</style>
</head>
<style>
/*.mloading-container {
  position: relative;
  min-height: 70px;
  -webkit-transition: height 0.6s ease-in-out;
  -o-transition: height 0.6s ease-in-out;
  transition: height 0.6s ease-in-out;
}
.mloading {
  position: absolute;
  background: #E9E9E8;
  font: normal 12px/22px "Microsoft Yahei", "微软雅黑", "宋体";
  display: none;
  z-index: 1600;
  background: rgba(233, 233, 232, 0);
}
.mloading.active {
  display: block;
}
.mloading.mloading-mask {
  background: rgba(233, 233, 232, 0.75);
  filter: progid:DXImageTransform.Microsoft.Alpha(opacity=75);
}
.mloading-full {
  position: fixed;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
}
.mloading-container > .mloading {
  top: 0px;
  left: 0px;
  width: 100%;
  height: 100%;
}
.mloading-body {
  width: 100%;
  height: 100%;
  position: relative;
}
.mloading-bar {
  width: 250px;
  min-height: 22px;
  text-align: center;
  background: #fff;
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.27);
  border-radius: 7px;
  padding: 20px 15px;
  font-size: 14px;
  color: #999;
  position: absolute;
  top: 50%;
  left: 50%;
  margin-left: -140px;
  margin-top: -30px;
  word-break: break-all;
}
@media (max-width: 300px) {
  .mloading-bar {
    width: 62px;
    height: 56px;
    margin-left: -30px !important;
    margin-top: -30px !important;
    padding: 0;
    line-height: 56px;
  }
  .mloading-bar > .mloading-text {
    display: none;
  }
}
.mloading-bar-sm {
  width: 62px;
  height: 56px;
  margin-left: -30px !important;
  margin-top: -30px !important;
  padding: 0;
  line-height: 56px;
}
.mloading-bar-sm > .mloading-text {
  display: none;
}
.mloading-icon {
  width: 16px;
  height: 16px;
  vertical-align: middle;
}
.mloading-text {
  margin-left: 10px;
}*/


</style>
<div id="back_divaa">
<!-- <div class="mloading mloading-full mloading-mask active"><div class="mloading-body"><div class="mloading-bar" style="margin-top: -31px; margin-left: -140px;"><img class="mloading-icon" src="data:image/gif;base64,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"><span class="mloading-text">加载中...</span></div></div></div> -->

</div>
<!--
<div id="back_divaa"  ></div> -->
<body style="background-color: #ffffff;">
	<div id="wrap" class="flex-wrap flex-vertical" >
	  <div id="main" class="flex-con " >
	    <div class="login-bg container" style="padding-top:0; padding-bottom:0">
			<div class="logo"> <img src="image/sbg.png" width="100%"> </div>
	      <form class="bs-example bs-example-form" role="form">
	        <div class="input-group"> <span class="input-group-addon"><img src="image/s01.png"></span>
	          <input type="text" class="form-control" placeholder="用户名"  id="username" >
						  <!-- <input type="text" class="form-control" placeholder="用户名" type="iphone" id="usera" > -->
	        </div>
			  <div class="input-group"> <span class="input-group-addon"><img src="image/s02.png"></span>
	          <input type="password" id="password" class="form-control" placeholder="密码" >
						  <!-- <input type="password" id="passa" class="form-control" placeholder="密码" > -->

	        </div>
	      </form>
<div style="height:20px; line-height:20px; width:75%; margin:-5px auto 0px auto" id="stswz"></div>

			<div class="gr-btn" id="dl" style="padding-top:5px; margin-top:5px">
				<button id="onc"  onClick="sublogin()" ontouchstart=gtouchstart() ontouchend="gtouchend()" type="button">立即登录</button>
		  </div>

			  <div class="login-footer">南昌赣昌砂石有限公司@2018</div>
	    </div>


	  </div>


	</div>
<script>

function gtouchstart()
{
	document.getElementById('onc').style.background = "linear-gradient(to right, #c0ecfe, #17baff )";
}
function gtouchend()
{
	  setTimeout(function() {
  	document.getElementById('onc').style.background = "linear-gradient(to right, #17baff, #178aff )";
  }, 150) ;

}

</script>

		<!-- <div class="container">
	        <form class="form-signin">
	            <div style="height:150px;"></div>
	            <label for="inputEmail" class="sr-only">iphone</label>
	            <input type="iphone" id="username" class="form-control" placeholder="用户名" required="" autofocus="">
	            <label for="inputPassword" class="sr-only">Password</label>
	            <input type="password" id="password" class="form-control" placeholder="密码" required="">
	            <button type="button" class="btn btn-danger" onClick="sublogin()" style="color:#ffffff">登录</button>

	        </form>
	    </div> -->



</body>
<script type="text/javascript" src="./script/api.js"></script>
<script type="text/javascript" src="./script/common.js"></script>
<script type="text/javascript" src="./script/map.js"></script>
<script type="text/javascript" src="./script/mapzh.js"></script>
<script type="text/javascript" src="./script/tuisong.js"></script>
<!-- <script type="text/javascript" src="./script/jquery.cookie.js"></script> -->
<script>

function initialize() {
					 // 初始化sdk并监听透传消息
					 console.log("cc");
					 uzgetuisdk.initialize(function(ret) {
						  console.log("bb");
						 console.log(JSON.stringify(ret));
						 if(ret['payload']=="下线通知")
						 {
							 api.toast({
						 										msg: '有用户通过其他设备登录,现退出账户',
						 										duration: 2000,
						 										location: 'middle'
						 										});
						 										　subexits_szc();
						 										　return;
						 										}


							 // 获取到cid后的回调通知
							 //document.getElementById("txt_getui_cid").innerHTML = "cid:" + ret.cid;
							 //alert(JSON.stringify(ret));
							 switch (ret.type) {
									 case 'cid':

									// 		 value = 'cid:' + ret.cid;
											//  if(ret.cid)
											//  {
											// 	 console.log(ret.cid);
											// 	 console.log("aa1");
											//  }
                  //  clientid=ret.cid;

				$api.setStorage('s_cid',ret.cid);//推送
				 console.log(233111);
			console.log(JSON.stringify(ret));
										//	 console.log(value);
											//	    var ccyid_el=document.getElementById("ccyid");
										//		$api.val(ccyid_el,ret.cid);
		  //  var dl_el=document.getElementById("dl");
			//	$api.css(dl_el,"display:block");

											// document.getElementById("txt_getui_cid").innerHTML = "cid:" + ret.cid;
// if(	$api.getStorage('s_jt')==1)
// {
// 	console.log();
//
// 											 loginForCId(namea, passa, ret.cid);
// }
   break;
									 case 'payload':
											// value = 'payload:' + ret.payload;

											// console.log(JSON.stringify(ret));
											 //console.log(ret.payload);
										var item=	 JSON.parse(ret.payload)
											 //var item=ret.payload;
										//	console.log(item['uid']);
										console.log("222");
//console.log(JSON.stringify(ret.payload));
// 										if(item.indexOf("下线通知")>-1){
// 											api.toast({
// 										msg: '有用户通过其他设备登录,现退出账户',
// 										duration: 2000,
// 										location: 'middle'
// 										});
// 										　subexits_sz();
// 										//　return;
// 										}
// else {

console.log(23);

										var item_id=item['uid'];
																				//	 console.log(ret.payload.uid);
										//

								//		console.log(item['status']);
										var title;
										var msg;


										if(item['status']==1)
										{
										 title="确认运单";
										 msg="您有新运单要确认";
										}
										else if(item['status']==2)
										{
										 title="确认运单";
										 msg="您有新运单要确认";
										}
										else if(item['status']==3)
										{
										 title="开始运输";
										 msg="您的运单已确认,可以开始运输";
										}
										else if(item['status']==5)
										{
										 title="确认运单";
										 msg="您有新运单要确认";
										}
										else if(item['status']==6)
										{
										 title="运单已修改";
										 msg="您的运单已被修改";
										}
										else if(item['status']==10)
										{
										 title="卸货确认";
										 msg="您的运单已确认可以卸货";
										}
										else if(item['status']==8)
										{
										 title="签收确认";
										 msg="您的运单已卸货，请确认";
										}
										else if(item['status']==9)
										{
										 title="已签收";
										 msg="您的运单已签收";
										}
										else {
											title="您有订单需要处理";
											msg="";
										}
										console.log("监听");
//   // setTimeout(function() {
										api.confirm({
										    title: title,
										    msg: msg,
										    buttons: ['确定', '取消']
										}, function(ret, err) {
										    var index = ret.buttonIndex;
										    if(index==1)
												{
										//console.log(item_id);
													// if($api.getStorage('uqx')==6)
																if($api.getStorage('uroles')=='采砂船管理员')
													  {

														//	openorderinfo(item_id);

																	if(item['status']==1)
																	{
																			 openorder_wsa(item_id);
																	}
																 else {
																			openorderinfo(item_id);
																 }

														}
													else if($api.getStorage('uroles')=='采砂船船主')
													  {openorderinfo_5(item_id);}
														else if($api.getStorage('uroles')=='采运船主')
															{openorderinfo_8(item_id);}

													else if($api.getStorage('uroles')=='运砂船船主')
													  {
															openorderinfo_4(item_id);
															// if($api.getStorage('dy'+$api.getStorage('usid'))==1)
															// {api.prompt({
															//     buttons: ['确定', '取消']
															// }, function(ret, err) {
															//     var index = ret.buttonIndex;
															//     var text = ret.text;
															// 		if(index==1)
															// 		{
															//
															// 			api.execScript({
															// 						name: 'root',
															// 			script: 'mapdw();'
															// 			});
															// 				openorderinfo_4(item_id);
															// 		}
															// 		else {
															// 			$api.rmStorage('yunshuid'+$api.getStorage('usid'))
															// 			$api.rmStorage('dy'+$api.getStorage('usid'));
															// 				openorderinfo_4(item_id);
															//
															// 		}
															// });}
															// else {
															// 	openorderinfo_4(item_id);
															// }


														}
													else if($api.getStorage('uroles')=='砂场收货员')
													  {openorderinfo_3(item_id);}

													};
													setSerBadge();
													setAppBadge();
												}
										);
  // }, 2000) ;
//}




											//  document.getElementById("txt_getui_taskid").innerHTML = "taskid:" + ret.taskId;
											//  document.getElementById("txt_getui_messageid").innerHTML = "messageid:" + ret.messageId;
											//  document.getElementById("txt_getui_payload").innerHTML = "payload:" + ret.payload;
											 break;
									 case 'occurError':
											// value = 'occurError';
											 console.log("occurError");
											 break;
							 }
					 });

					 var param = {
							 deviceToken: api.deviceToken,
					 };
				//	 document.getElementById("txt_getui_deviceToken").innerHTML = "deviceToken:" + api.deviceToken;
					 //注册deviceToken
					 uzgetuisdk.registerDeviceToken(param, function(ret, err) {


						 uzgetuisdk.fetchClientId(function(ret, err) {

							 	$api.setStorage('s_cid',ret.cid);//推送
// console.log(ret.cid);
// console.log(1);
						 });

							 //var log = 'registerDeviceToken:' + ret.result;
							 //console.log(log);
			//				 document.getElementById("txt_getui_registResult").innerHTML = "RegistResult:" + ret.result;
					 });

					 //旧方法，已删除
					 // uzgetuisdk.register(function(ret) {
					 // 	document.getElementById("txt_getui_taskid").innerHTML = "taskid:" + ret.taskid;
					 // 	document.getElementById("txt_getui_messageid").innerHTML = "messageid:" + ret.messageid;
					 // 	document.getElementById("txt_getui_payload").innerHTML = "payload:" + ret.payload;
					 // });
			 }

			 function openorderinfo(uid)
			 {

			         api.openWin({

			                    name : 'order_orderinfo',
			                    url : 'html/order/orderinfo.html',
			                    slidBackEnabled:false,
			                    reload:true,
			                    pageParam: {id: uid},

			            });

			 }

			 function openorder_wsa(uid)
			 {
			     api.openWin({
			   name : 'order_createrorder_ws',
			   url : 'html/order/createrorder_ws.html',
			   slidBackEnabled:false,
			     hideHomeIndicator:true,
			   reload:true,
			    pageParam: {id: uid},
			       });

			 }

			 function openorderinfo_5(uid)
			 {

			         api.openWin({

			                    name : 'order_orderinfo_5',
			                    url : 'html/order/orderinfo_5.html',
			                    slidBackEnabled:false,
			                    reload:true,
			                    pageParam: {id: uid},

			            });

			 }

			 function openorderinfo_8(uid)
			 {

			 				api.openWin({

			 									 name : 'order_orderinfo_8',
			 									 url : 'html/order/orderinfo_8.html',
			 									 slidBackEnabled:false,
			 									 reload:true,
			 									 pageParam: {id: uid},

			 					 });

			 }
			 function openorderinfo_4(uid)
			 {

			         api.openWin({

			                    name : 'order_orderinfo_4',
			                    url : 'html/order/orderinfo_4.html',
			                    slidBackEnabled:false,
			                    reload:true,
			                    pageParam: {id: uid},

			            });

			 }

			 function openorderinfo_3(uid)
			 {

			         api.openWin({

			                    name : 'order_orderinfo_3',
			                    url : 'html/order/orderinfo_3.html',
			                    slidBackEnabled:false,
			                    reload:true,
			                    pageParam: {id: uid},

			            });

			 }
			//  var myVar = setInterval(function(){ checkline() }, 4000);
			 //
			//   function checkline()
			 //
			//   {
			// 		if(api.connectionType == 'none'){
			 //
			// 						api.toast({
			// 			    msg: '网络错误',
			// 			    duration: 2000,
			// 			    location: 'middle'
			// 			});
			// 		      }
			//   }

   apiready = function () {

console.log(api.deviceToken);


		 uzgetuisdk = api.require('pushGeTui');

		//  uzgetuisdk.fetchClientId(function(ret, err) {
		 //
		// 		 $api.setStorage('s_cid',ret.cid);//推送
		// 	});
		 initialize();

		//  setSerBadge();
		// 	setAppBadge();
		 //uzgetuisdk = api.require('pushGeTui');

	            //初始化
	   //initialize();
		 //
		//  reportLocation = api.require('reportLocation');
		//  reportLocation2 = api.require('reportLocation');
		//  api.addEventListener({
		//  		name:'online'
		//  }, function(ret, err){
		// 	 console.log(211);
		 //
		//  	//getLocation4(trace_interval, trace_accuracy, trace_filter,uid)
		//  		alert('已连接到网络');
		//  });

		api.getPrefs({
			key: 'loginStatus'
		}, function(ret, err) {
				//当偏好设置尚未设置或者曾设置后被移除后，返回值(ret.value)均为空。
				var val = ret.value;
				// console.log(JSON.stringify(val));
				if (val && val != ""&&val=='loginSuccess') {
opencheckjson();
					 if($api.getStorage('uroles')=='管理员')
					 {

						 api.openWin({

						 							 name : 'glylist',
						 							 url : 'html/order/glylist.html',
						 							 slidBackEnabled:false,
						 							 reload:true,
						 							 animation:{
						 								 type:"fade",
						 								 subType:"from_bottom",
						 						 }

						 			 });

					 }
				else	 if($api.getStorage('uroles')=='片区负责人')
					 {

						 api.openWin({

						 							 name : 'pqglylist',
						 							 url : 'html/order/pqglylist.html',
						 							 slidBackEnabled:false,
						 							 reload:true,
						 							 animation:{
						 								 type:"fade",
						 								 subType:"from_bottom",
						 						 }

						 			 });

					 }
					 else	 if($api.getStorage('uroles')=='采区负责人')
							{

								api.openWin({

															name : 'order_orderlist7',
															url : 'html/order/orderlist7.html',
															slidBackEnabled:false,
															reload:true,
															animation:{
																type:"fade",
																subType:"from_bottom",
														}

											});

							}
					 else {

						 api.openWin({

														name : 'order_orderlist',
														url : 'html/order/orderlist.html',
														slidBackEnabled:false,
														reload:true,
														animation:{
															type:"fade",
															subType:"from_bottom",
													}

										});


										if($api.getStorage('dy'+$api.getStorage('usid'))==1)
								 	 {

										 api.ajax({
								         url: functionURL + 'wayBillScreen/getListForApp.json',
								         method: 'get',
								         headers:
								         {

								           login_token:$api.getStorage('loginToken')
								         },
								         data: {
								             values: {
								                 uid:$api.getStorage('yx_uid')
								             },
								             files: {
								                 file: 'fs://a.gif'
								             }
								         }
								     }, function(ret, err) {
								         if (ret) {

																			 if( ret['data'].length>0){
																   var item = ret['data'][0];
																	 if(item['status']==4)
																	 {
																		 		api.confirm({
																		 				title: '之前有订单未结束',
																		 				msg: '继续进行该订单运输',
																		 				buttons: ['确定', '取消']
																		 		}, function(ret, err) {
																		 							var index = ret.buttonIndex;

																		 							if(index==1)
																		 							{

																		 								api.execScript({
																		 											name: 'root',
																		 								script: 'mapdw();'
																		 								});

																		 							}
																		 							else {

																		 								$api.rmStorage('yunshuid'+$api.getStorage('usid'))
																		 								$api.rmStorage('dy'+$api.getStorage('usid'));
																		 								$api.rmStorage('yx_uid')

																		 							}
																		 					});
																	    }
																			else {
																				$api.rmStorage('yunshuid'+$api.getStorage('usid'))
																				$api.rmStorage('dy'+$api.getStorage('usid'));
																				$api.rmStorage('yx_uid')
																			}

																		}
								                }
														});

								 	 }


					 }




								//  api.execScript({
								//        name: 'root',
								//  script: 'closeroot();'
								//  });
								//  $api.rmStorage('yunshuid'+$api.getStorage('usid'))
								//  $api.rmStorage('dy'+$api.getStorage('usid'));

				}
		});


// 		 api.addEventListener({
// 		 		name:'offline'
// 		 }, function(ret, err){
// 		 			  //console.log(212);
// 		 	//getLocation4(trace_interval, trace_accuracy, trace_filter,uid)
// 		 	//	alert('断网了,请重新登录');
// 			api.toast({
//     msg: '网络异常',
//     duration: 2000,
//     location: 'middle'
// });
// 			subexits_szc();
//
//
// 		 });

		 api.addEventListener({
		 		name:'offline'
		 }, function(ret, err){
		//
		// 	 if($api.getStorage('dy'+$api.getStorage('usid'))==1)
		// 	 {
		// closeroot();
		// 	  $api.setStorage('webnetjt',1);
		// 	  }

		 });

		 api.addEventListener({
		 		name:'online'
		 }, function(ret, err){

if($api.getStorage('webnetjt')==1)
{
// mapdw();
//  $api.setStorage('webnetjt',0);
//  api.toast({
// 		 msg: '由于网络中断,重新开启定位',
// 		 duration: 2000,
// 		 location: 'middle',
// 		 	global:true
//  });

}
		 });

		 api.addEventListener({
				name:'myEventtcjson'
		 }, function(ret, err){
						//console.log(212);
			//getLocation4(trace_interval, trace_accuracy, trace_filter,uid)
			//	alert('断网了,请重新登录');

				subexits_szc();
	// api.closeWidget();

		 });


	//checkline()
	 //
	 }

function dmaponga()
{
	api.toast({
			msg: '开始定位',
			duration: 2000,
			location: 'middle'
	});

	if($api.getStorage('maptime')==1)
	{
		api.toast({
														 msg: '调用GPS 成功',
															duration: 2000,
													 location: 'middle'
		});
		//断();
		console.log(1);
		 //clearInterval(intervalId);
	}
	else

	{

		  //reportLocation.stopLocation();
		getLocation411();
	}
}
	 function mapdw()
	 {
		//  intervalId = setInterval( dmaponga,3000);

// dmaponga();
api.openFrame({
									name : 'root_f',
									url : 'index_f.html',
									 reload:true,
									slidBackEnabled:false,
									delay:150,
									animation:{
										type:"fade",
										subType:"from_bottom",
								}

							})

	 }

	 function closeroot()
	 {

	 	api.execScript({
	 			frameName:'root_f',

	 	script: 'closeroot_f();'
	 	});
}

	 function mapdwa()
	 {
	  getLocation311();
	 }
	 //获取cid
	 function fetchClientId() {
		    var ccyid_el=document.getElementById("ccyid");
			 uzgetuisdk.fetchClientId(function(ret, err) {
//clientid=ret.cid;
   $api.val(ccyid_el,ret.cid);
			 });
	 }
function sublogin(){
 $api.setStorage('webnetjt',0);

	//document.getElementById('onc').style.background = "linear-gradient(to right, #58ccff , #17baff )";

// 	var param = {
// 			deviceToken: api.deviceToken,
// 	};
// 	uzgetuisdk.registerDeviceToken(param, function(ret, err) {
// console.log(JSON.stringify(ret));
// //console.log(JSON.stringify(ret));
//  });
		 console.log($api.getStorage('s_cid'));
// 	uzgetuisdk.fetchClientId(function(ret, err) {
// //clientid=ret.cid;
//     var ccyid_el=document.getElementById("ccyid");
// $api.val(ccyid_el,ret.cid);
// clientid=ret.cid;
// 	});

//console.log(clientid);
  var stswz_el=document.getElementById("stswz");
	$api.html(stswz_el,'');

  var username_el=document.getElementById("username");
	if($api.val(username_el)=="")
	{
		$api.html(stswz_el,'<span class="glyphicon glyphicon-remove" style="font-size:9px; color:#F00; margin-right:5px"></span><bdi id="stswz"  style="color:#5f5f5f">用户名不能为空</bdi>');

		return false;
	}
	//  var usera_el=document.getElementById("usera");
  var password_el=document.getElementById("password");
	if($api.val(password_el)=="")
	{
		$api.html(stswz_el,'<span class="glyphicon glyphicon-remove" style="font-size:9px; color:#F00; margin-right:5px"></span><bdi id="stswz"  style="color:#5f5f5f">密码不能为空</bdi>');


		return false;
	}

//	$("#back_divaa").css("display","block");
var back_divaa_el=document.getElementById("back_divaa");
$api.css(back_divaa_el,'display:block');
//  	var passa_el=document.getElementById("passa");
api.ajax({

    url: functionURL + 'sysUserScreen/loginForApp.json',
    method: 'post',
		// returnAll:'true',//返回所有
    data: {
        values: {
            username: $api.val(username_el),
            password:$api.val(password_el),
						cid:$api.getStorage('s_cid'),
						phone_type:"ios"

        },
        files: {
            file: 'fs://a.gif'
        }
    }
}, function(ret, err) {

console.log(JSON.stringify(ret));
 $api.setStorage('loginToken',ret['loginToken']);
//
// var rethead=eval(res.headers);
//
// $api.setStorage('SetCookie',rethead['Set-Cookie']);
// console.log(rethead['Set-Cookie']);
// var ret=eval(res.body);
console.log(ret['userId']);
	      			          //  api.openWin({
												 //
	                      //                 name : 'order_orderlist',
	                      //                 url : 'html/order/orderlist.html',
	      								// 								slidBackEnabled:false,
	      								// 								reload:true,
												 //
	                      //         });
  	if (ret['userId']>0) {
          api.sendEvent({
             name: 'loginSuccess'
          });

          api.setPrefs({
            key: 'loginStatus',
            value: 'loginSuccess'
          });

          							$api.val(username_el,"");
          							$api.val(password_el,"");

	// 											$api.val(usera_el,$api.val(username_el));
	// 											$api.val(passa_el,$api.val(password_el));
	// $api.setStorage('s_jt',1);//判断 登录
					$api.setStorage('picturePath',ret['picturePath']);//登录ID
											$api.setStorage('usid',ret['userId']);//登录ID
											$api.setStorage('usname',ret['userName']);//用户
											$api.setStorage('uqx',ret['rightInfo']);//角色
											$api.setStorage('uroles',ret['roles']);//角色name
$api.setStorage('mobileRemark',ret['mobileRemark']);
var shijian_elb=$api.getStorage('shijian_el'+ret['userId']);
var juli_elb=$api.getStorage('juli_el'+ret['userId']);
var jingdu_elb=$api.getStorage('jingdu_el'+ret['userId']);
var zhaopian_elb=$api.getStorage('zhaopian_el'+ret['userId']);

if(shijian_elb==''||shijian_elb=='undefined'||shijian_elb==null)
{
	$api.setStorage('shijian_el'+ret['userId'],30)//定位最小时间间隔
}
if(juli_elb==''||juli_elb=='undefined'||juli_elb==null)
{
	$api.setStorage('juli_el'+ret['userId'],10)//定位最小间隔距离
}
if(jingdu_elb==''||jingdu_elb=='undefined'||jingdu_elb==null)
{
	$api.setStorage('jingdu_el'+ret['userId'],50)//过滤定位精度
}

if(zhaopian_elb==''||zhaopian_elb=='undefined'||zhaopian_elb==null)
{
	$api.setStorage('zhaopian_el'+ret['userId'],0)//过滤定位精度
}
// if($api.getStorage('shijian_el')==null)
// $api.setStorage('usid',ret['userId']);//登录ID

											if(ret['roles']=='采砂船管理员')//采砂管理员
											{

											   api.openWin({

											                  name : 'order_csc06',
											                  url : 'html/order/csc06.html',
											  								slidBackEnabled:false,
											  								reload:true,
											                  animation:{
											                    type:"fade",
											                    subType:"from_bottom",
											                }

											          });

											}

											else if(ret['roles']=='采砂船船主')//采沙船船主
											{

	console.log("12333");
												opencsc5(ret['userId']);
												//  api.openWin({
												 //
												// 								name : 'order_csc05',
												// 								url : 'html/order/csc05.html',
												// 								slidBackEnabled:false,
												// 								reload:true,
												// 								animation:{
												// 									type:"fade",
												// 									subType:"from_bottom",
												// 							}
												 //
												// 				});

											}

											else if(ret['roles']=='采运船主')//
											{

												opencsc8(ret['userId']);

											}

											else if(ret['roles']=='管理员')//管理员
											{


												 api.openWin({

																				name : 'glylist',
																				url : 'html/order/glylist.html',
																				slidBackEnabled:false,
																				reload:true,
																				animation:{
																					type:"fade",
																					subType:"from_bottom",
																			}

																});

											}

											else if(ret['roles']=='运砂船船主')//运沙船船主
											{

//console.log("运沙船");
//$api.setStorage('dy'+ret['userId'],1);//登录ID
//console.log($api.getStorage('dy'+$api.getStorage('usid')));

if($api.getStorage('dy'+$api.getStorage('usid'))==1)
{

 api.ajax({
		 url: functionURL + 'wayBillScreen/getListForApp.json',
		 method: 'get',
		 headers:
		 {

			 login_token:$api.getStorage('loginToken')
		 },
		 data: {
				 values: {
						 uid:$api.getStorage('yx_uid')
				 },
				 files: {
						 file: 'fs://a.gif'
				 }
		 }
 }, function(ret, err) {
		 if (ret) {

									 if( ret['data'].length>0){
							 var item = ret['data'][0];
							 if(item['status']==4)
							 {
										api.confirm({
												title: '之前有订单未结束',
												msg: '继续进行该订单运输',
												buttons: ['确定', '取消']
										}, function(ret, err) {
															var index = ret.buttonIndex;

															if(index==1)
															{

																api.execScript({
																			name: 'root',
																script: 'mapdw();'
																});

															}
															else {

																$api.rmStorage('yunshuid'+$api.getStorage('usid'))
																$api.rmStorage('dy'+$api.getStorage('usid'));
																$api.rmStorage('yx_uid')

															}
													});
									}
									else {
										$api.rmStorage('yunshuid'+$api.getStorage('usid'))
										$api.rmStorage('dy'+$api.getStorage('usid'));
										$api.rmStorage('yx_uid')
									}

								}
						}
				});

}

//if($api.getStorage('dy'+$api.getStorage('usid'))==1)
//{

	// api.confirm({
	//     title: '之前有订单未结束',
	//     msg: '继续进行该订单运输',
	//     buttons: ['确定', '取消']
	// }, function(ret, err) {
	// 			    var index = ret.buttonIndex;
	//
	// 					if(index==1)
	// 					{
	//
	// 						api.execScript({
	// 									name: 'root',
	// 						script: 'mapdw();'
	// 						});
	//
	// 					}
	// 					else {
	//
	// 						$api.rmStorage('yunshuid'+$api.getStorage('usid'))
	// 						$api.rmStorage('dy'+$api.getStorage('usid'));
	// 						$api.rmStorage('yx_uid')
	//
	// 					}
	// 			});

//}

		opencsc4(ret['userId']);


												//  api.openWin({
												 //
												// 								name : 'order_csc05',
												// 								url : 'html/order/csc05.html',
												// 								slidBackEnabled:false,
												// 								reload:true,
												// 								animation:{
												// 									type:"fade",
												// 									subType:"from_bottom",
												// 							}
												 //
												// 				});

											}

											else if(ret['roles']=='砂场收货员')//沙场收货员
											{
											   api.openWin({

											                  name : 'order_csc03',
											                  url : 'html/order/csc03.html',
											  								slidBackEnabled:false,
											  								reload:true,
											                  animation:{
											                    type:"fade",
											                    subType:"from_bottom",
											                }

											          });

											}


											else if(ret['roles']=='二级砂厂负责人')//沙场收货员
											{

		opencsc33(ret['userId']);

											}


											else if(ret['roles']=='采区负责人')//沙场收货员
											{

											 	  api.openWin({

																			 name : 'order_csc07',
																			 url : 'html/order/csc07.html',
																			 slidBackEnabled:false,
																			 reload:true,
																			 animation:{
																				 type:"fade",
																				 subType:"from_bottom",
																		 }

															 });


											}
											else if(ret['roles']=='片区负责人')//沙场收货员
											{

											 	  api.openWin({

																			 name : 'order_csc08',
																			 url : 'html/order/csc08.html',
																			 slidBackEnabled:false,
																			 reload:true,
																			 animation:{
																				 type:"fade",
																				 subType:"from_bottom",
																		 }

															 });


											}
											else {
												$api.setStorage('usid');//登录ID
												$api.setStorage('usname');//用户
												$api.setStorage('uqx');//角色
												$api.setStorage('uroles');//角色name
												$api.css(back_divaa_el,'display:none');
												$api.html(stswz_el,'<span class="glyphicon glyphicon-remove" style="font-size:9px; color:#F00; margin-right:5px"></span><bdi id="stswz"  style="color:#5f5f5f">此用户角色非法</bdi>');
												api.sendEvent({
														name: 'logoutSuccess'
												});
												//api.removePrefs移除登录状态
												api.removePrefs({
														key: 'loginStatus'
												});
												return ;

											}
											// else{
											//
											//   api.openWin({
											//
											//                  name : 'order_orderlist',
											//                  url : 'html/order/orderlist.html',
											//                  slidBackEnabled:false,
											//                  reload:true,
											//                  animation:{
											//                    type:"fade",
											//                    subType:"from_bottom",
											//                }
											//
											//          });
											//
											// }

          			          //  api.openWin({
                           //
                          //                 name : 'order_orderlist',
                          //                 url : 'html/order/orderlist.html',
          								// 								slidBackEnabled:false,
          								// 								reload:true,
                           //
                          //         });

opencheckjson();
setTimeout(function(){
$api.css(back_divaa_el,'display:none');
},500)

    }
    else {
			$api.css(back_divaa_el,'display:none');
			$api.html(stswz_el,'<span class="glyphicon glyphicon-remove" style="font-size:9px; color:#F00; margin-right:5px"></span><bdi id="stswz"  style="color:#5f5f5f">用户名或密码错误</bdi>');

      // api.alert({
      //        msg: '用户名或密码错误'
      //    });
    }

});
}



function opencheckjson()
{
	api.openFrame({
										name : 'index_check',
										url : 'check.html',
										 reload:true,
										slidBackEnabled:false,
										delay:150,
										animation:{
											type:"fade",
											subType:"from_bottom",
									}

								})
}
function opencsc5(sid)
{

//	console.log(sid);
	api.ajax({
			url: functionURL + 'sandBoatScreen/getList.json',
			method: 'get',
			headers:
			{

				login_token:$api.getStorage('loginToken')
			},
			data: {
					values: {
								ownerId:sid
					},
					files: {
							file: 'fs://a.gif'
					}
			}
	}, function(ret, err) {
					if(ret){


							if( ret['data'].length>0)
							{

								    var item = ret['data'][0];
											//		console.log(JSON.stringify(item));

												$api.setStorage('sandboatId',item['uid']);//登录ID
												$api.setStorage('sandboatName',item['name']);//用户

												api.closeWin({
						                name: 'order_orderlist'
						            });
								api.openWin({

															 name : 'order_orderlist',
															 url : 'html/order/orderlist.html',
															 slidBackEnabled:false,
															 reload:true,
															 animation:{
																 type:"fade",
																 subType:"from_bottom",
														 }

											 });

							}
							else
							{
								api.closeFrame({
								    name: 'index_check'
								});
								api.toast({
																 msg: '没有绑定采砂船,请您联系管理员',
																 duration: 2000,
																 location: 'middle'
																 });
																 　subexits_szc();
																 　return;

							}
			}
	});

}

function opencsc8(sid)
{

//	console.log(sid);
	api.ajax({
			url: functionURL + 'sandBoatScreen/getList.json',
			method: 'get',
			headers:
			{

				login_token:$api.getStorage('loginToken')
			},
			data: {
					values: {
								ownerId:sid
					},
					files: {
							file: 'fs://a.gif'
					}
			}
	}, function(ret, err) {
					if(ret){


							if( ret['data'].length>0)
							{

								    var item = ret['data'][0];
											//		console.log(JSON.stringify(item));

												$api.setStorage('sandboatId',item['uid']);//登录ID
												$api.setStorage('sandboatName',item['name']);//用户

												api.closeWin({
						                name: 'order_orderlist'
						            });
								api.openWin({

															 name : 'order_orderlist',
															 url : 'html/order/orderlist.html',
															 slidBackEnabled:false,
															 reload:true,
															 animation:{
																 type:"fade",
																 subType:"from_bottom",
														 }

											 });

							}
			}
	});

}


function opencsc4(sid)
{

//	console.log(sid);
	api.ajax({
			url: functionURL + 'sandCarrierScreen/getSandCarrierByUser.json',
			method: 'get',
			headers:
			{

				login_token:$api.getStorage('loginToken')
			},
			data: {
					values: {
								userId:sid
					},
					files: {
							file: 'fs://a.gif'
					}
			}
	}, function(ret, err) {
					if(ret){


							if( ret['data'].length>0)
							{

								    var item = ret['data'][0];
											//		console.log(JSON.stringify(item));

												$api.setStorage('boatId',item['uid']);//
												$api.setStorage('boatName',item['name']);//

												api.closeWin({
						                name: 'order_orderlist'
						            });

								api.openWin({

															 name : 'order_orderlist',
															 url : 'html/order/orderlist.html',
															 slidBackEnabled:false,
															 reload:true,
															 animation:{
																 type:"fade",
																 subType:"from_bottom",
														 }

											 });

							}
			}
	});

}

function opencsc33(sid)
{

//	console.log(sid);
//http://47.96.165.26:8080/ncgctest/sandPlantScreen/getAll.json?user_id=1299&level=2
	api.ajax({
			url: functionURL + 'sandPlantScreen/getAll.json',
			method: 'get',
			headers:
			{

				login_token:$api.getStorage('loginToken')
			},
			data: {
					values: {
								userId:sid,
								level:2
					},
					files: {
							file: 'fs://a.gif'
					}
			}
	}, function(ret, err) {
					if(ret){


							if( ret['data'].length>0)
							{

								    var item = ret['data'][0];
												console.log(JSON.stringify(item));

												$api.setStorage('toDistrict',item['uid']);//
$api.setStorage('toDistrictname',item['name']);//沙场

												api.closeWin({
						                name: 'order_orderlist'
						            });

								api.openWin({

															 name : 'order_orderlist',
															 url : 'html/order/orderlist.html',
															 slidBackEnabled:false,
															 reload:true,
															 animation:{
																 type:"fade",
																 subType:"from_bottom",
														 }

											 });

							}
							else
							{
								api.closeFrame({
										name: 'index_check'
								});
								api.toast({
																 msg: '没有绑定二级砂场,请您联系管理员',
																 duration: 2000,
																 location: 'middle'
																 });
																 　subexits_szc();
																 　return;

							}
			}
	});

}
</script>
</html>
